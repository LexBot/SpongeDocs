
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Использование Economy API &mdash; Документация Sponge 7.2.0</title>

    <link rel="shortcut icon" href="../../_static/favicon.ico"/>




    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    <link rel="stylesheet" href="../../_static/spongedocs.css" type="text/css" />

        <link rel="index" title="Алфавитный указатель"
              href="../../genindex.html"/>        <link rel="search" title="Поиск" href="../../search.html"/>    <link rel="top" title="Документация Sponge 7.2.0" href="../../index.html"/>        <link rel="up" title="Экономика" href="index.html"/>        <link rel="next" title="Рекомендации по использованию Economy API" href="practices.html"/>        <link rel="prev" title="Основные понятия" href="basics.html"/>
    <!-- Google Analytics -->
    <script>
        (function(S,p,o,n,g,i,e){S['GoogleAnalyticsObject']=g;S[g]=S[g]||function(){
        (S[g].q=S[g].q||[]).push(arguments)},S[g].l=1*new Date();i=p.createElement(o),
        e=p.getElementsByTagName(o)[0];i.async=1;i.src=n;e.parentNode.insertBefore(i,e)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-59476017-2', 'auto');
        ga('send', 'pageview');
    </script>

  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
    <div id="sp-logo-container" class="page-scroll">
        <a class="logo" href="../../index.html">
            <img src="../../_static/spongie-mark-dark.svg">
            <span>Sponge</span>
            <i class="fa fa-fw fa-chevron-down"></i>
        </a>
        <div id="sp-logo-menu">
            <ul id="sp-logo-dropdown">
                <li><a href="https://www.spongepowered.org"><i class="fa-fw fa fa-home"></i>Homepage</a></li>
                <li><a href="https://forums.spongepowered.org"><i class="fa-fw fa fa-comments"></i>Forums</a></li>
                <li><a href="https://github.com/SpongePowered"><i class="fa-fw fa fa-code"></i>Code</a></li>
                <li class="active"><a href="https://docs.spongepowered.org"><i class="fa-fw fa fa-book"></i>Docs</a></li>
                <li><a href="https://jd.spongepowered.org"><i class="fa-fw fa fa-graduation-cap"></i>Javadocs</a></li>
                <li><a href="https://forums.spongepowered.org/c/plugins/plugin-releases"><i class="fa-fw fa fa-plug"></i>Plugins</a></li>
                <li><a href="https://ore.spongepowered.org"><img src="../../_static/ore.svg" alt="" class="fa-fw fa ore-logo">Ore <sup>Beta</sup></a></li>
                <li><a href="https://www.spongepowered.org/downloads"><i class="fa-fw fa fa-download"></i>Downloads</a></li>
                <li><a href="https://www.spongepowered.org/chat"><i class="fa-fw fa fa-comment"></i>Chat</a></li>
            </ul>
        </div>
    </div>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../server/index.html">Создание сервера</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions/index.html">Versioning Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../preparing/index.html">Подготовка к разработке</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Создание плагина</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-versions.html">Версии API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buildsystem.html">Система сборки</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workspace/index.html">Подготовка рабочего пространства</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/index.html">Настройка проекта</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-identifier.html">Идентификаторы плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-class.html">Основной класс плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lifecycle.html">Жизненный цикл плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../injection.html">Внедрение зависимостей</a></li>
<li class="toctree-l2"><a class="reference internal" href="../practices/index.html">Полезные советы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optional/index.html">Дополнительно</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Ведение логов (журналов) и отладка</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/index.html">Текст</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Команды</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event/index.html">События</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">Настройка плагинов</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assets.html">API ресурсов</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html">API данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blocks/index.html">Блоки</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entities/index.html">Сущности</a></li>
<li class="toctree-l2"><a class="reference internal" href="../items/index.html">Предметы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trade-offers.html">Торговля</a></li>
<li class="toctree-l2"><a class="reference internal" href="../effects.html">Эффекты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html">Планировщик</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services.html">Сервисы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database.html">Базы данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="../permissions.html">Разрешения</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bans.html">Баны</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">Сбор данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bookview.html">Книга просмотров</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Экономика</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="basics.html">Основные понятия</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Использование Economy API</a></li>
<li class="toctree-l3"><a class="reference internal" href="practices.html">Рекомендации по использованию Economy API</a></li>
<li class="toctree-l3"><a class="reference internal" href="implementing.html">Внедрение Economy API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../wgen/index.html">Генерация мира</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manager.html">Менеджер плагинов</a></li>
<li class="toctree-l2"><a class="reference internal" href="../game-profile-manager.html">Игровой менеджер профилей</a></li>
<li class="toctree-l2"><a class="reference internal" href="../offline-userplayer-data.html">Данные о вышедших игроках</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tab-lists.html">Таблисты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-meta.html">Метаданные плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ray-tracing.html">Трассировка лучей</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging.html">Отладка плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html">Учебные руководства</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/index.html">Implementation-dependent Plugins</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ore/index.html">Документация Ore</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Участие в разработке Sponge</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">О проекте Sponge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Sponge</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">

 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
          <li><a href="../index.html">Создание плагина</a> &raquo;</li>
          <li><a href="index.html">Экономика</a> &raquo;</li>
    <li>Использование Economy API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plugin/economy/using.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
  <div class="section" id="using-the-economy-api">
<h1>Использование Economy API<a class="headerlink" href="#using-the-economy-api" title="Ссылка на этот заголовок">¶</a></h1>
<p>Economy API объединяет все плагины экономики под одним API. Это означает, что любой плагин, использующий Economy API, будет совместим со всеми плагинами экономики, которые реализуют указанный API. На этой странице вы узнаете, как его использовать в Вашем собственном плагине.</p>
<div class="section" id="loading-the-economyservice">
<h2>Загрузка EconomyService<a class="headerlink" href="#loading-the-economyservice" title="Ссылка на этот заголовок">¶</a></h2>
<p>Чтобы использовать Economy API, вы должны сначала загрузить класс <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/economy/EconomyService.html">EconomyService</a> используя <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/ServiceManager.html">ServiceManager</a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Вам нужно обращать внимание на различные <code class="docutils literal notranslate"><span class="pre">game</span> <span class="pre">states</span></code>, когда сервер запускается, останавливается или работает при использовании таких сервисов, как Economy API. Посмотрите на странице <a class="reference internal" href="../services.html"><span class="doc">Сервисы</span></a> для получения дополнительной информации.</p>
</div>
<div class="section" id="example-loading-the-economyservice">
<h3>Пример: Загрузка EconomyService<a class="headerlink" href="#example-loading-the-economyservice" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.spongepowered.api.service.economy.EconomyService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.Sponge</span><span class="p">;</span>

<span class="n">Optional</span><span class="o">&lt;</span><span class="n">EconomyService</span><span class="o">&gt;</span> <span class="n">serviceOpt</span> <span class="o">=</span> <span class="n">Sponge</span><span class="p">.</span><span class="na">getServiceManager</span><span class="p">().</span><span class="na">provide</span><span class="p">(</span><span class="n">EconomyService</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">serviceOpt</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// handle there not being an economy implementation</span>
<span class="p">}</span>
<span class="n">EconomyService</span> <span class="n">economyService</span> <span class="o">=</span> <span class="n">serviceOpt</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Предупреждение</p>
<p class="last">Храните этот сервис в локальной переменной вместо глобальной переменной, поскольку реализация может измениться в любой момент. Если вам нужно хранить сервис глобально, по какой-либо причине используйте <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/event/service/ChangeServiceProviderEvent.html">ChangeServiceProviderEvent</a>, чтобы обновлять реализацию.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">В отличие от других сервисов, вы должны пытаться использовать <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/ServiceManager.html#provide-java.lang.Class-">ServiceManager#provide(Class)</a> вместо <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/ServiceManager.html#provideUnchecked-java.lang.Class-">ServiceManager#provideUnchecked(Class)</a>, потому что Sponge не предоставляет реализацию по умолчанию для <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/economy/EconomyService.html">EconomyService</a>, и поэтому он не гарантирует, что он существует.</p>
</div>
</div>
</div>
<div class="section" id="using-the-economyservice">
<h2>Использование EconomyService<a class="headerlink" href="#using-the-economyservice" title="Ссылка на этот заголовок">¶</a></h2>
<p>После загрузки <code class="docutils literal notranslate"><span class="pre">EconomyService</span></code> и присвоения ей переменной вы готовы получить доступ ко всем функциям, которые может предложить Economy API.</p>
<div class="section" id="example-getting-a-player-s-balance">
<h3>Пример: Получение баланса игрока<a class="headerlink" href="#example-getting-a-player-s-balance" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.living.player.Player</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.service.economy.EconomyService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.service.economy.account.UniqueAccount</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.math.BigDecimal</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="n">Optional</span><span class="o">&lt;</span><span class="n">UniqueAccount</span><span class="o">&gt;</span> <span class="n">uOpt</span> <span class="o">=</span> <span class="n">economyService</span><span class="p">.</span><span class="na">getOrCreateAccount</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="na">getUniqueId</span><span class="p">());</span>
<span class="k">if</span> <span class="p">(</span><span class="n">uOpt</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">UniqueAccount</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">uOpt</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
    <span class="n">BigDecimal</span> <span class="n">balance</span> <span class="o">=</span> <span class="n">acc</span><span class="p">.</span><span class="na">getBalance</span><span class="p">(</span><span class="n">economyService</span><span class="p">.</span><span class="na">getDefaultCurrency</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Некоторые методы <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/economy/account/Account.html">Account</a> требуют таких переменных, как:</p>
<ul class="simple">
<li>Валюта: участвующая в обмене валюта</li>
<li>Причина: что вызвало изменение учётной записи</li>
<li>Контекст: контекст, в котором произошло изменение</li>
</ul>
<p>Они предназначены для более продвинутых видов использования, но всё равно должны быть заполнены. Ниже приведен список допустимых значений по умолчанию:</p>
<ul class="simple">
<li>Валюта: <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/economy/EconomyService.html#getDefaultCurrency--">EconomyService#getDefaultCurrency()</a></li>
<li>Cause: <code class="docutils literal notranslate"><span class="pre">Cause.of(EventContext.builder().add(EventContextKeys.PLUGIN,</span> <span class="pre">plugin).build(),</span> <span class="pre">plugin)</span></code></li>
<li>Контекст: <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">HashSet&lt;Context&gt;()</span></code></li>
</ul>
</div>
</div>
</div>

           </div>
          </div>
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="practices.html" class="btn btn-neutral float-right" title="Рекомендации по использованию Economy API" accesskey="n" rel="next">Далее <span class="fa fa-angle-right"></span></a>
        <a href="basics.html" class="btn btn-neutral" title="Основные понятия" accesskey="p" rel="prev"><span class="fa fa-angle-left"></span> Назад</a>
    </div>

    <hr/>

    <section id="license-footer">
        <p>Except where otherwise noted,
            <a xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" property="dct:title" rel="cc:attributionURL" href="https://github.com/SpongePowered/SpongeDocs">SpongeDocs</a>
            is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </p>
        <a id="license-icons" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" title="CC-BY-SA" aria-hidden="true">cba</a>
    </section>
</footer>        </div>
      </div>

    </section>

  </div>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <i class="fa fa-book"> <span>SpongeDocs</span></i>
        v: 7.2.0
    <img src="../../_static/flags/ru_RU.svg"
         alt="ru" title="Русский">
        <span class="fa fa-caret-down"></span>
    </span>
    <div id="versions" class="rst-other-versions">




    </div>
</div>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'7.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>      <script type="text/javascript" src="../../_static/jquery.js"></script>      <script type="text/javascript" src="../../_static/underscore.js"></script>      <script type="text/javascript" src="../../_static/doctools.js"></script>      <script type="text/javascript" src="../../_static/language_data.js"></script>      <script type="text/javascript" src="../../_static/translations.js"></script>      <script type="text/javascript" src="../../_static/spongedocs.js"></script>

    <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
 
</body>
</html>