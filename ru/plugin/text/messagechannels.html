
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Каналы сообщений &mdash; Документация Sponge 7.2.0</title>

    <link rel="shortcut icon" href="../../_static/favicon.ico"/>




    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    <link rel="stylesheet" href="../../_static/spongedocs.css" type="text/css" />

        <link rel="index" title="Алфавитный указатель"
              href="../../genindex.html"/>        <link rel="search" title="Поиск" href="../../search.html"/>    <link rel="top" title="Документация Sponge 7.2.0" href="../../index.html"/>        <link rel="up" title="Текст" href="index.html"/>        <link rel="next" title="Текстовые шаблоны" href="templates.html"/>        <link rel="prev" title="Разбиение на страницы" href="pagination.html"/>
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
    <div id="sp-logo-container" class="page-scroll">
        <a class="logo" href="../../index.html">
            <img src="../../_static/spongie-mark-dark.svg">
            <span>Sponge</span>
            <i class="fa fa-fw fa-chevron-down"></i>
        </a>
        <div id="sp-logo-menu">
            <ul id="sp-logo-dropdown">
                <li><a href="https://www.spongepowered.org"><i class="fa-fw fa fa-home"></i>Homepage</a></li>
                <li><a href="https://forums.spongepowered.org"><i class="fa-fw fa fa-comments"></i>Forums</a></li>
                <li><a href="https://github.com/SpongePowered"><i class="fa-fw fa fa-code"></i>Code</a></li>
                <li class="active"><a href="https://docs.spongepowered.org"><i class="fa-fw fa fa-book"></i>Docs</a></li>
                <li><a href="https://jd.spongepowered.org"><i class="fa-fw fa fa-graduation-cap"></i>Javadocs</a></li>
                <li><a href="https://forums.spongepowered.org/c/plugins/plugin-releases"><i class="fa-fw fa fa-plug"></i>Plugins</a></li>
                <li><a href="https://ore.spongepowered.org"><img src="../../_static/ore.svg" alt="" class="fa-fw fa ore-logo">Ore <sup>Beta</sup></a></li>
                <li><a href="https://www.spongepowered.org/downloads"><i class="fa-fw fa fa-download"></i>Downloads</a></li>
                <li><a href="https://www.spongepowered.org/chat"><i class="fa-fw fa fa-comment"></i>Chat</a></li>
            </ul>
        </div>
    </div>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../server/index.html">Создание сервера</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions/index.html">Versioning Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../preparing/index.html">Подготовка к разработке</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Создание плагина</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-versions.html">Версии API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buildsystem.html">Система сборки</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workspace/index.html">Подготовка рабочего пространства</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/index.html">Настройка проекта</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-identifier.html">Идентификаторы плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-class.html">Основной класс плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lifecycle.html">Жизненный цикл плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../injection.html">Внедрение зависимостей</a></li>
<li class="toctree-l2"><a class="reference internal" href="../practices/index.html">Полезные советы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optional/index.html">Дополнительно</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Ведение логов (журналов) и отладка</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Текст</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="text.html">Создание текста</a></li>
<li class="toctree-l3"><a class="reference internal" href="representations/index.html">Сериализация текста</a></li>
<li class="toctree-l3"><a class="reference internal" href="pagination.html">Разбиение на страницы</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Каналы сообщений</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html">Текстовые шаблоны</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Команды</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event/index.html">События</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">Настройка плагинов</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assets.html">API ресурсов</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html">API данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blocks/index.html">Блоки</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entities/index.html">Сущности</a></li>
<li class="toctree-l2"><a class="reference internal" href="../items/index.html">Предметы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trade-offers.html">Торговля</a></li>
<li class="toctree-l2"><a class="reference internal" href="../effects.html">Эффекты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html">Планировщик</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services.html">Сервисы</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database.html">Базы данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="../permissions.html">Разрешения</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bans.html">Баны</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">Сбор данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bookview.html">Книга просмотров</a></li>
<li class="toctree-l2"><a class="reference internal" href="../economy/index.html">Экономика</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wgen/index.html">Генерация мира</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manager.html">Менеджер плагинов</a></li>
<li class="toctree-l2"><a class="reference internal" href="../game-profile-manager.html">Игровой менеджер профилей</a></li>
<li class="toctree-l2"><a class="reference internal" href="../offline-userplayer-data.html">Данные о вышедших игроках</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tab-lists.html">Таблисты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-meta.html">Метаданные плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ray-tracing.html">Трассировка лучей</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging.html">Отладка плагина</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html">Учебные руководства</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/index.html">Implementation-dependent Plugins</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ore/index.html">Документация Ore</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Участие в разработке Sponge</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">О проекте Sponge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Sponge</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">

 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
          <li><a href="../index.html">Создание плагина</a> &raquo;</li>
          <li><a href="index.html">Текст</a> &raquo;</li>
    <li>Каналы сообщений</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plugin/text/messagechannels.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
  <div class="section" id="message-channels">
<h1>Каналы сообщений<a class="headerlink" href="#message-channels" title="Ссылка на этот заголовок">¶</a></h1>
<p>В Sponge каждый объект, в который могут быть отправлены сообщения, реализует интерфейс <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageReceiver.html">MessageReceiver</a>. <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html">MessageChannel</a> — это устройство, которое может отправлять сообщения на любое количество <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code>-ов и даже выполнять такие действия, как форматирование сообщения, зависящее от получателя.</p>
<div class="section" id="selecting-message-recipients">
<h2>Выбор получателей сообщений<a class="headerlink" href="#selecting-message-recipients" title="Ссылка на этот заголовок">¶</a></h2>
<p>В интерфейсе <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> есть константы и статические методы, которые можно использовать для получения или создания часто используемых каналов. Существуют также другие классы и интерфейсы, которые могут быть использованы для создания <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>, такие как <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/AbstractMutableMessageChannel.html">AbstractMutableMessageChannel</a> и <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html">MutableMessageChannel</a>. Полный список их можно найти в <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/package-summary.html">org.spongepowered.api.text.channel</a> и его подпакетах.</p>
<div class="section" id="broadcasting">
<h3>Трансляция<a class="headerlink" href="#broadcasting" title="Ссылка на этот заголовок">¶</a></h3>
<p>Наиболее распространенным каналом будет канал вещания. Его можно получить либо из <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/Server.html">Server</a> методом <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/Server.html#getBroadcastChannel--">Server#getBroadcastChannel()</a>, либо из константы <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#TO_PLAYERS">MessageChannel#TO_PLAYERS</a> или <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#TO_ALL">MessageChannel#TO_ALL</a>. Единственное отличие состоит в том, что <code class="docutils literal notranslate"><span class="pre">TO_ALL</span></code> включает в себя не только всех игроков, подключенных к серверу, но и сервер <code class="docutils literal notranslate"><span class="pre">Console</span></code>.</p>
<p>Канал, возвращаемый <code class="docutils literal notranslate"><span class="pre">getBroadcastChannel()</span></code>, обычно является каналом <code class="docutils literal notranslate"><span class="pre">MessageChannel.TO_ALL</span></code>, однако другой канал может быть установлен методом <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/Server.html#setBroadcastChannel-org.spongepowered.api.text.channel.MessageChannel-">Server#setBroadcastChannel(MessageChannel)</a>.</p>
</div>
<div class="section" id="sending-to-a-fixed-list-of-messagereceivers">
<h3>Отправка в фиксированный список MessageReceivers<a class="headerlink" href="#sending-to-a-fixed-list-of-messagereceivers" title="Ссылка на этот заголовок">¶</a></h3>
<p>Также возможно отправить сообщение не всем подключенным игрокам, а нескольким выбранным вручную получателям. Это можно сделать, передав список предполагаемых получателей методу <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#fixed-org.spongepowered.api.text.channel.MessageReceiver...-">MessageChannel#fixed(MessageReceiver…)</a>. В отличие от большинства других каналов, список получателей не будет генерироваться динамически каждый раз, когда что-то отправляется через канал, а остается статичным до конца его существования. Тем не менее, сохраненные ссылки <em>слабы</em>. Это означает, что если, например, игрок отключается и соответствующий объект <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/entity/living/player/Player.html">Player</a> удаляется <em>сборщиком мусора</em> Java, этот игрок также исчезает из списка получателей каналов.</p>
</div>
<div class="section" id="permission-based-selection">
<h3>Выбор на основе Permissions<a class="headerlink" href="#permission-based-selection" title="Ссылка на этот заголовок">¶</a></h3>
<p>Также возможно создать канал для отправки всем получателям, у которых есть специальное разрешение. Канал получается из метода <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#permission-java.lang.String-">MessageChannel#permission(String)</a> с разрешением на проверку в качестве аргумента. Когда сообщение отправляется через этот канал, он получает все объекты из <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/service/permission/PermissionService.html">PermissionService</a>, которые имеют данное разрешение.</p>
</div>
<div class="section" id="combining-channels">
<h3>Объединение каналов<a class="headerlink" href="#combining-channels" title="Ссылка на этот заголовок">¶</a></h3>
<p>Также возможно объединить несколько каналов в один. Это можно сделать, передав все каналы в метод <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#combined-org.spongepowered.api.text.channel.MessageChannel...-">MessageChannel#combined(MessageChannel…)</a>. Результирующий канал будет ретранслировать сообщения каждому получателю, на который нацелен по меньшей мере один из комбинированных каналов.</p>
</div>
</div>
<div class="section" id="sending-messages">
<h2>Отправка сообщений<a class="headerlink" href="#sending-messages" title="Ссылка на этот заголовок">¶</a></h2>
<p>После того, как вы получили <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>, вы можете отправить сообщение с помощью метода <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#send-java.lang.Object-org.spongepowered.api.text.Text-">MessageChannel#send(Object, Text)</a>. Этот метод является предпочтительным по сравнению с методом <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#send-org.spongepowered.api.text.Text-">MessageChannel#send(Text)</a>, поскольку <code class="docutils literal notranslate"><span class="pre">Object</span></code> может использоваться для идентификации или для выполнения других различных действий. Кроме того, вы можете использовать <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/chat/ChatType.html">ChatType</a>, чтобы указать, куда будет отправлено сообщение. Использование метода <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#send-java.lang.Object-org.spongepowered.api.text.Text-org.spongepowered.api.text.chat.ChatType-">MessageChannel#send(Object, Text, ChatType)</a> позволит вам сделать это. Затем канал преобразует сообщение для каждого получателя и отправляет преобразованное сообщение.</p>
<div class="section" id="extended-application-chat-channels">
<h3>Расширенное применение: Чат-каналы<a class="headerlink" href="#extended-application-chat-channels" title="Ссылка на этот заголовок">¶</a></h3>
<p>Каналы сообщений имеют очень полезное применение, поскольку они могут быть использованы для создания чат-каналов. Например, вы можете установить канал сообщений для каждого чат-канала, который вы хотите. Затем, когда <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code> присоединяется к каналу, например, через <code class="docutils literal notranslate"><span class="pre">/join</span> <span class="pre">&lt;channel</span> <span class="pre">name&gt;</span></code>, просто устанавливайте <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code>-а на соответствующий канал, используя <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageReceiver.html#setMessageChannel-org.spongepowered.api.text.channel.MessageChannel-">MessageReceiver#setMessageChannel(MessageChannel)</a>. Это приведет к тому, что каждое сообщение, отправленное <em>из</em> <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code>, будет передано данному <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> вместо значения по умолчанию. В качестве альтернативы, вы можете прослушивать <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/event/message/MessageChannelEvent.html">MessageChannelEvent</a> и устанавливать соответствующий <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>, используя <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/event/message/MessageChannelEvent.html#setChannel-org.spongepowered.api.text.channel.MessageChannel-">MessageChannelEvent#setChannel(MessageChannel)</a>. Передача <code class="docutils literal notranslate"><span class="pre">null</span></code> этому методу отключит любой пользовательский канал, в результате чего сообщение будет отправлено исходному MessageChannel.</p>
</div>
</div>
<div class="section" id="transforming-messages">
<h2>Преобразование сообщений<a class="headerlink" href="#transforming-messages" title="Ссылка на этот заголовок">¶</a></h2>
<p>Вы можете применить фильтр ко всем <code class="docutils literal notranslate"><span class="pre">Text</span></code>-ам, которые проходят через <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>, чтобы изменить сообщение, как вам нравится. Это возможно за счёт расширения <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> и переопределения метода <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#transformMessage-java.lang.Object-org.spongepowered.api.text.channel.MessageReceiver-org.spongepowered.api.text.Text-org.spongepowered.api.text.chat.ChatType-">MessageChannel#transformMessage(Object, MessageReceiver, Text, ChatType)</a>, как показано ниже.</p>
<p><strong>Пример: Преобразование сообщений</strong></p>
<p>Следующий фрагмент кода определяет класс <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code>, который переопределяет метод <code class="docutils literal notranslate"><span class="pre">transformMessage</span></code>. Новый метод <code class="docutils literal notranslate"><span class="pre">transformMessage</span></code> примет исходное сообщение и добавит красный тег <code class="docutils literal notranslate"><span class="pre">[Admin]</span></code> в начало сообщения.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.Text</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageChannel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.chat.ChatType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.format.TextColors</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminMessageChannel</span> <span class="kd">implements</span> <span class="n">MessageChannel</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Text</span><span class="o">&gt;</span> <span class="nf">transformMessage</span><span class="p">(</span><span class="n">Object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MessageReceiver</span> <span class="n">recipient</span><span class="p">,</span>
                <span class="n">Text</span> <span class="n">original</span><span class="p">,</span> <span class="n">ChatType</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">TextColors</span><span class="p">.</span><span class="na">RED</span><span class="p">,</span> <span class="s">&quot;[Admin]&quot;</span><span class="p">,</span> <span class="n">TextColors</span><span class="p">.</span><span class="na">RESET</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="nf">getMembers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Обратите внимание, что мы не хотим определять каких-либо дополнительных получателей, поэтому мы возвращаем пустую коллекцию в методе <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#getMembers--">MessageChannel#getMembers()</a>.</p>
<p>Благодаря возможностям комбинированного <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>, мы можем объединить недавно созданный <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code> с любым другим <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>. Теперь, если игрок зашел на сервер с разрешением <code class="docutils literal notranslate"><span class="pre">myplugin.admin</span></code>, мы получим его исходный `` MessageChannel``, объединим его с <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code> и устанавливают объединенный канал обратно игроку. Таким образом, все его сообщения отправляются всем, указанным в исходном канале, но из-за добавления <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code>, будет префикс с красным тегом <code class="docutils literal notranslate"><span class="pre">[Admin]</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.living.player.Player</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.event.Listener</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.event.network.ClientConnectionEvent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageChannel</span><span class="p">;</span>

<span class="kd">private</span> <span class="n">AdminMessageChannel</span> <span class="n">adminChannel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AdminMessageChannel</span><span class="p">();</span>

<span class="nd">@Listener</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClientConnectionJoin</span><span class="p">(</span><span class="n">ClientConnectionEvent</span><span class="p">.</span><span class="na">Join</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Player</span> <span class="n">player</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="na">getTargetEntity</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="na">hasPermission</span><span class="p">(</span><span class="s">&quot;myplugin.admin&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">MessageChannel</span> <span class="n">originalChannel</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="na">getOriginalChannel</span><span class="p">();</span>
        <span class="n">MessageChannel</span> <span class="n">newChannel</span> <span class="o">=</span> <span class="n">MessageChannel</span><span class="p">.</span><span class="na">combined</span><span class="p">(</span><span class="n">originalChannel</span><span class="p">,</span>
            <span class="n">adminChannel</span><span class="p">);</span>
        <span class="n">player</span><span class="p">.</span><span class="na">setMessageChannel</span><span class="p">(</span><span class="n">newChannel</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Обратите внимание, что это будет префикс <cite>всех</cite> сообщений, относящихся к игроку. Сюда входят сообщения о смерти, сообщения о выходе и т.д. Если Вам нужны префиксы только к сообщениям <cite>чата</cite>, Вам нужно будет прослушать <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/event/message/MessageChannelEvent.Chat.html">MessageChannelEvent.Chat</a> и установить канал на событие, а не на игрока. Это можно сделать при помощи <code class="docutils literal notranslate"><span class="pre">event.setChannel(newChannel)</span></code> для события <code class="docutils literal notranslate"><span class="pre">MessageChannelEvent.Chat</span></code>. Чтобы получить игрока из события для проверки разрешений, вам нужно будет получить <code class="docutils literal notranslate"><span class="pre">Player</span></code> из <code class="docutils literal notranslate"><span class="pre">Cause</span></code> события. Это показано ниже:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span> <span class="n">playerOptional</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="na">getCause</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span><span class="n">first</span><span class="p">(</span><span class="n">Player</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</pre></div>
</div>
<p>Подробнее о причинах смотрите <a class="reference internal" href="../event/causes.html"><span class="doc">здесь</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">При объединении нескольких <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>, определяющих различные преобразования сообщений, <code class="docutils literal notranslate"><span class="pre">Text</span></code> будет преобразован в том порядке, в котором <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> передается в метод <code class="docutils literal notranslate"><span class="pre">MessageChannel#combined(MessageChannel...</span> <span class="pre">channels)</span></code>. Обратите внимание, что любые преобразования, приводящие к пустым <code class="docutils literal notranslate"><span class="pre">Optional</span></code>, будут игнорироваться, если не будут выполнены последним каналом в цепочке.</p>
</div>
</div>
<div class="section" id="mutable-message-channels">
<h2>Изменяемые Каналы Сообщений<a class="headerlink" href="#mutable-message-channels" title="Ссылка на этот заголовок">¶</a></h2>
<p><a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html">MutableMessageChannel</a> содержит методы для изменения того, кто может получать сообщения, отправленные через наш канал. Таким образом, мы должны реализовать методы для выполнения действий, которые изменяют наших пользователей. Для этого мы просто создадим класс с именем <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code>, который реализует <code class="docutils literal notranslate"><span class="pre">MutableMessageChannel</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.WeakHashMap</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.Text</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MutableMessageChannel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.chat.ChatType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.format.TextColors</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MutableAdminMessageChannel</span> <span class="kd">implements</span> <span class="n">MutableMessageChannel</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="n">members</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">MutableAdminMessageChannel</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">emptySet</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">MutableAdminMessageChannel</span><span class="p">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="n">members</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">members</span> <span class="o">=</span> <span class="n">Collections</span><span class="p">.</span><span class="na">newSetFromMap</span><span class="p">(</span><span class="k">new</span> <span class="n">WeakHashMap</span><span class="o">&lt;&gt;</span><span class="p">());</span>
        <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">members</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="nf">getMembers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">unmodifiableSet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addMember</span><span class="p">(</span><span class="n">MessageReceiver</span> <span class="n">member</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">member</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeMember</span><span class="p">(</span><span class="n">MessageReceiver</span> <span class="n">member</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">member</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearMembers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Text</span><span class="o">&gt;</span> <span class="nf">transformMessage</span><span class="p">(</span><span class="n">Object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MessageReceiver</span> <span class="n">recipient</span><span class="p">,</span>
                <span class="n">Text</span> <span class="n">original</span><span class="p">,</span> <span class="n">ChatType</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">recipient</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">TextColors</span><span class="p">.</span><span class="na">RED</span><span class="p">,</span> <span class="s">&quot;[Admin]&quot;</span><span class="p">,</span> <span class="n">TextColors</span><span class="p">.</span><span class="na">RESET</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Основное различие между нашим <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code> и нашим новым <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code> заключается в том, что мы проверяем, находится ли получатель в списке членов перед преобразованием сообщения. Если это так, мы можем изменить отправленное сообщение, добавив красный префикс <code class="docutils literal notranslate"><span class="pre">[Admin]</span></code>. В нашем методе <code class="docutils literal notranslate"><span class="pre">getMembers()</span></code> мы возвращаем неизменяемый набор, так что набор может быть изменен только соответствующими методами в нашем <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code>.</p>
<p>Note that an abstract implementation for <code class="docutils literal notranslate"><span class="pre">MutableMessageChannel</span></code>s exists in SpongeAPI as
<code class="docutils literal notranslate"><span class="pre">AbstractMutableMessageChannel</span></code>. Also note that our members do not persist. If a player were to leave the server,
they would be removed from the set.</p>
<div class="section" id="modifying-the-members">
<h3>Изменение членов<a class="headerlink" href="#modifying-the-members" title="Ссылка на этот заголовок">¶</a></h3>
<p>Чтобы полностью использовать наш <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code>, мы должны иметь возможность добавлять и удалять участников из канала. Для этого мы можем просто вызвать наш <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html#addMember-org.spongepowered.api.text.channel.MessageReceiver-">MutableMessageChannel#addMember(MessageReceiver)</a> и <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html#removeMember-org.spongepowered.api.text.channel.MessageReceiver-">MutableMessageChannel#removeMember(MessageReceiver)</a> методы, которые мы реализовали ранее, когда нам нужно добавить или удалить пользователя из набора элементов.</p>
</div>
</div>
</div>

           </div>
          </div>
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="templates.html" class="btn btn-neutral float-right" title="Текстовые шаблоны" accesskey="n" rel="next">Далее <span class="fa fa-angle-right"></span></a>
        <a href="pagination.html" class="btn btn-neutral" title="Разбиение на страницы" accesskey="p" rel="prev"><span class="fa fa-angle-left"></span> Назад</a>
    </div>

    <hr/>

    <section id="license-footer">
        <p>Except where otherwise noted,
            <a xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" property="dct:title" rel="cc:attributionURL" href="https://github.com/SpongePowered/SpongeDocs">SpongeDocs</a>
            is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </p>
        <a id="license-icons" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" title="CC-BY-SA" aria-hidden="true">cba</a>
    </section>
</footer>        </div>
      </div>

    </section>

  </div>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <i class="fa fa-book"> <span>SpongeDocs</span></i>
        v: 7.2.0
    <img src="../../_static/flags/ru_RU.svg"
         alt="ru" title="Русский">
        <span class="fa fa-caret-down"></span>
    </span>
    <div id="versions" class="rst-other-versions">




    </div>
</div>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'7.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>      <script type="text/javascript" src="../../_static/jquery.js"></script>      <script type="text/javascript" src="../../_static/underscore.js"></script>      <script type="text/javascript" src="../../_static/doctools.js"></script>      <script type="text/javascript" src="../../_static/language_data.js"></script>      <script type="text/javascript" src="../../_static/translations.js"></script>      <script type="text/javascript" src="../../_static/spongedocs.js"></script>

    <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
 
</body>
</html>