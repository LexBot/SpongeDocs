
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Transactions &mdash; Documentation Sponge 7.2.0</title>

    <link rel="shortcut icon" href="../../_static/favicon.ico"/>




    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    <link rel="stylesheet" href="../../_static/spongedocs.css" type="text/css" />

        <link rel="index" title="Index"
              href="../../genindex.html"/>        <link rel="search" title="Recherche" href="../../search.html"/>    <link rel="top" title="Documentation Sponge 7.2.0" href="../../index.html"/>        <link rel="up" title="La Data API" href="index.html"/>        <link rel="next" title="Sérialisation de données" href="serialization.html"/>        <link rel="prev" title="Manipulateurs de données" href="datamanipulators.html"/>
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
    <div id="sp-logo-container" class="page-scroll">
        <a class="logo" href="../../index.html">
            <img src="../../_static/spongie-mark-dark.svg">
            <span>Sponge</span>
            <i class="fa fa-fw fa-chevron-down"></i>
        </a>
        <div id="sp-logo-menu">
            <ul id="sp-logo-dropdown">
                <li><a href="https://www.spongepowered.org"><i class="fa-fw fa fa-home"></i>Homepage</a></li>
                <li><a href="https://forums.spongepowered.org"><i class="fa-fw fa fa-comments"></i>Forums</a></li>
                <li><a href="https://github.com/SpongePowered"><i class="fa-fw fa fa-code"></i>Code</a></li>
                <li class="active"><a href="https://docs.spongepowered.org"><i class="fa-fw fa fa-book"></i>Docs</a></li>
                <li><a href="https://jd.spongepowered.org"><i class="fa-fw fa fa-graduation-cap"></i>Javadocs</a></li>
                <li><a href="https://forums.spongepowered.org/c/plugins/plugin-releases"><i class="fa-fw fa fa-plug"></i>Plugins</a></li>
                <li><a href="https://ore.spongepowered.org"><img src="../../_static/ore.svg" alt="" class="fa-fw fa ore-logo">Ore <sup>Beta</sup></a></li>
                <li><a href="https://www.spongepowered.org/downloads"><i class="fa-fw fa fa-download"></i>Downloads</a></li>
                <li><a href="https://www.spongepowered.org/chat"><i class="fa-fw fa fa-comment"></i>Chat</a></li>
            </ul>
        </div>
    </div>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../server/index.html">Créer un Serveur</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions/index.html">Stratégie de versioning</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../preparing/index.html">Préparation pour le développement</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Création d’un Plugin</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-versions.html">Versions de l’API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buildsystem.html">Build Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workspace/index.html">Mise en Place de votre Espace de Travail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/index.html">Configurer Votre Projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-identifier.html">Identifiants de Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-class.html">Classe Principale du Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lifecycle.html">Cycle de vie des Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../injection.html">Injection de Dépendances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../practices/index.html">Bonnes Pratiques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optional/index.html">Optionnels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Journalisation (Logging) et Débogage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/index.html">Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Commandes de Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event/index.html">Événements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">Configuration des plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assets.html">L’API des Ressources</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">La Data API</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="custom/index.html">Données Customisées</a></li>
<li class="toctree-l3"><a class="reference internal" href="catalog-types.html">Catalog Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="keys.html">Utilisation des Clés</a></li>
<li class="toctree-l3"><a class="reference internal" href="datamanipulators.html">Manipulateurs de données</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Transactions</a></li>
<li class="toctree-l3"><a class="reference internal" href="serialization.html">Sérialisation de données</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../blocks/index.html">Blocs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entities/index.html">Entités</a></li>
<li class="toctree-l2"><a class="reference internal" href="../items/index.html">Items</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trade-offers.html">Trade-Offers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../effects.html">Effets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html">Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database.html">Bases de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="../permissions.html">Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bans.html">Bans</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">Collection de Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bookview.html">Views d’un Livre</a></li>
<li class="toctree-l2"><a class="reference internal" href="../economy/index.html">Économie</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wgen/index.html">Génération du monde</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manager.html">Gestionnaire de Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../game-profile-manager.html">Gestionnaire de Profil de Jeu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../offline-userplayer-data.html">Données du Joueur Hors-Ligne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tab-lists.html">Tab Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-meta.html">Plugin Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ray-tracing.html">Ray Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging.html">Debugging d’un plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html">Tutoriels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/index.html">Plugins dépendants des implémentations</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ore/index.html">Documentation d’Ore</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contribuer à Sponge</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">À propos du Projet Sponge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Sponge</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">

 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
          <li><a href="../index.html">Création d’un Plugin</a> &raquo;</li>
          <li><a href="index.html">La Data API</a> &raquo;</li>
    <li>Transactions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plugin/data/transactions.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
  <div class="section" id="transactions">
<h1>Transactions<a class="headerlink" href="#transactions" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="reading-the-result">
<h2>Lire les résultats<a class="headerlink" href="#reading-the-result" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour tout ce que vous <code class="docutils literal notranslate"><span class="pre">offrez</span></code> à un data holder, la méthode <code class="docutils literal notranslate"><span class="pre">offer</span></code> donnera un <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataTransactionResult.html">DataTransactionResult</a>. Cet objet contiendra ce qui suit:</p>
<div class="section" id="type">
<h3>Type<a class="headerlink" href="#type" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataTransactionResult.Type.html">DataTransactionResult.Type</a> indique si la transaction s’est faite avec succès ou si elle a échoué.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">UNDEFINED</span></code></td>
<td>Aucun résultat clair de la transaction - indique que quelque s’est mal passé</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code></td>
<td>La transaction a été effectuée avec succès</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">FAILURE</span></code></td>
<td>La transaction a échoué pour des raisons connues (ex. données incompatibles)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ERROR</span></code></td>
<td>La transaction a échoué pour des raison inconnues</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">CANCELLED</span></code></td>
<td>Un event pour cette transaction a été annulé</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-affected-data">
<h3>Les Données affectées<a class="headerlink" href="#the-affected-data" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le résultat fournit aussi quelques listes immuables qui contiennent des valeurs immuables représentant des données qui ont été impliquées dans la transaction.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">getSuccessfulData()</span></code></td>
<td>contient toutes les données qui ont été correctement définies</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">getReplacedData()</span></code></td>
<td>contient toutes les données qui ont été remplacées par des données assignées avec succès</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">getRejectedData()</span></code></td>
<td>contient toutes les données qui n’ont pas pu être définies</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="examples">
<h2>Exemples<a class="headerlink" href="#examples" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="healing-a-player">
<h3>Soigner un Joueur<a class="headerlink" href="#healing-a-player" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous vous souvenez surement de l’exemple du healing de la page <a class="reference internal" href="keys.html"><span class="doc">Utilisation des Clés</span></a>. Imaginez qu’un joueur qui est descendu à un demi-cœur (qui équivaut à 1 point de vie) est soigné de cette façon. Le <code class="docutils literal notranslate"><span class="pre">DataTransactionResult</span></code> dans ce cas là, devrais ressembler à ça:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">getType()</span></code> devrait retourner <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">getRejectedData()</span></code> devrait donner une liste vide</li>
<li><code class="docutils literal notranslate"><span class="pre">getReplacedData()</span></code> devrait retourner un conteneur de valeur pour <code class="docutils literal notranslate"><span class="pre">Keys.HEALTH</span></code> avec une valeur de 1.0</li>
<li><code class="docutils literal notranslate"><span class="pre">getSuccessfulData()</span></code> devrait contenir un conteneur de valeur pour <code class="docutils literal notranslate"><span class="pre">Keys.HEALTH</span></code> avec une valeur de 20.0</li>
</ul>
<p>Maintenant qu’est-ce qui serait différent si nous utilisions l’exemple de healing de la page <a class="reference internal" href="datamanipulators.html"><span class="doc">Manipulateurs de données</span></a> à la place ? Puisque que le manipulateur de données <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/mutable/entity/HealthData.html">HealthData</a> contient des valeurs pour le niveau de vie actuel et la vie maximale, en plus du résultat ci-dessus, la liste <code class="docutils literal notranslate"><span class="pre">getReplacedData()</span></code> et la liste <code class="docutils literal notranslate"><span class="pre">getSuccessfulData()</span></code> devraient contenir un élément de plus: Un conteneur de valeurs pour <code class="docutils literal notranslate"><span class="pre">Keys.MAX_HEALTH</span></code> avec une valeur de 20.0.</p>
</div>
<div class="section" id="offering-healthdata-to-a-block-of-stone">
<h3>Donner un HealthData à un block de stone<a class="headerlink" href="#offering-healthdata-to-a-block-of-stone" title="Lien permanent vers ce titre">¶</a></h3>
<p>Maintenant nos exemples mentionnés ci-dessus sont codés de telle manière qu’ils vont échouer silencieusement plutôt que d’essayer d’offrir les données incompatibles. Mais imaginez que nous prenons la <code class="docutils literal notranslate"><span class="pre">HealthData</span></code> d’un joueur (guéri complètement) et essayons de l’offrir à la <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/world/Location.html">Location</a> du bloc de pierre sur lequel il se trouve actuellement. Nous pouvons faire ceci, puisque <code class="docutils literal notranslate"><span class="pre">Location</span></code> est aussi un data holder. Et si nous le faisons, il nous récompenserait avec un <code class="docutils literal notranslate"><span class="pre">DataTransactionResult</span></code> comme ceci :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">getType()</span></code> retournerait <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">getRejectedData()</span></code> retournerait deux conteneurs de valeurs pour les clés <code class="docutils literal notranslate"><span class="pre">HEALTH</span></code> et <code class="docutils literal notranslate"><span class="pre">MAX_HEALTH</span></code>, avec chacune une valeur de 20.0</li>
<li><code class="docutils literal notranslate"><span class="pre">getReplacedData()</span></code> et <code class="docutils literal notranslate"><span class="pre">getSuccessfulData()</span></code> seraient des listes vides</li>
</ul>
</div>
</div>
<div class="section" id="reverting-transactions">
<h2>Rétablir une Transaction<a class="headerlink" href="#reverting-transactions" title="Lien permanent vers ce titre">¶</a></h2>
<p>Puisque tout sur le résultat de la transaction est immutable, il peut servir pour la documentation des modications de données. Et il permet également à ces modifications qu’il documente d’être annulées. Pour cela, passez simplement un résultat de transaction à la méthode <code class="docutils literal notranslate"><span class="pre">undo()</span></code> du data holder. C’est particulièrement utile puisque certaines offres de données peuvent être partiellement réussies, de sorte qu’une ou plusieurs valeurs soient correctement écrites au data holder, mais une valeur ou plus ne peuvent pas être acceptées. Étant donné que vous pouvez annuler les succès partiels.</p>
<p><strong>Exemple de Code : Annuler une transaction</strong></p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.spongepowered.api.data.DataHolder</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.data.DataTransactionResult</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.data.manipulator.DataManipulator</span><span class="p">;</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">safeOffer</span><span class="p">(</span><span class="n">DataHolder</span> <span class="n">target</span><span class="p">,</span> <span class="n">DataManipulator</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DataTransactionResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">target</span><span class="p">.</span><span class="na">offer</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">getType</span><span class="p">()</span> <span class="o">!=</span> <span class="n">DataTransactionResult</span><span class="p">.</span><span class="na">Type</span><span class="p">.</span><span class="na">SUCCESS</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">target</span><span class="p">.</span><span class="na">undo</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>

           </div>
          </div>
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="serialization.html" class="btn btn-neutral float-right" title="Sérialisation de données" accesskey="n" rel="next">Suivant <span class="fa fa-angle-right"></span></a>
        <a href="datamanipulators.html" class="btn btn-neutral" title="Manipulateurs de données" accesskey="p" rel="prev"><span class="fa fa-angle-left"></span> Précédent</a>
    </div>

    <hr/>

    <section id="license-footer">
        <p>Except where otherwise noted,
            <a xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" property="dct:title" rel="cc:attributionURL" href="https://github.com/SpongePowered/SpongeDocs">SpongeDocs</a>
            is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </p>
        <a id="license-icons" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" title="CC-BY-SA" aria-hidden="true">cba</a>
    </section>
</footer>        </div>
      </div>

    </section>

  </div>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <i class="fa fa-book"> <span>SpongeDocs</span></i>
        v: 7.2.0
    <img src="../../_static/flags/fr_FR.svg"
         alt="fr" title="Français">
        <span class="fa fa-caret-down"></span>
    </span>
    <div id="versions" class="rst-other-versions">




    </div>
</div>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'7.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>      <script type="text/javascript" src="../../_static/jquery.js"></script>      <script type="text/javascript" src="../../_static/underscore.js"></script>      <script type="text/javascript" src="../../_static/doctools.js"></script>      <script type="text/javascript" src="../../_static/language_data.js"></script>      <script type="text/javascript" src="../../_static/translations.js"></script>      <script type="text/javascript" src="../../_static/spongedocs.js"></script>

    <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
 
</body>
</html>