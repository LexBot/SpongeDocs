
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Implémenter Vos Propres AITasks &mdash; Documentation Sponge 7.2.0</title>

    <link rel="shortcut icon" href="../../_static/favicon.ico"/>




    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    <link rel="stylesheet" href="../../_static/spongedocs.css" type="text/css" />

        <link rel="index" title="Index"
              href="../../genindex.html"/>        <link rel="search" title="Recherche" href="../../search.html"/>    <link rel="top" title="Documentation Sponge 7.2.0" href="../../index.html"/>        <link rel="up" title="Entités" href="index.html"/>        <link rel="next" title="Items" href="../items/index.html"/>        <link rel="prev" title="IA d’Entité" href="ai.html"/>
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
    <div id="sp-logo-container" class="page-scroll">
        <a class="logo" href="../../index.html">
            <img src="../../_static/spongie-mark-dark.svg">
            <span>Sponge</span>
            <i class="fa fa-fw fa-chevron-down"></i>
        </a>
        <div id="sp-logo-menu">
            <ul id="sp-logo-dropdown">
                <li><a href="https://www.spongepowered.org"><i class="fa-fw fa fa-home"></i>Homepage</a></li>
                <li><a href="https://forums.spongepowered.org"><i class="fa-fw fa fa-comments"></i>Forums</a></li>
                <li><a href="https://github.com/SpongePowered"><i class="fa-fw fa fa-code"></i>Code</a></li>
                <li class="active"><a href="https://docs.spongepowered.org"><i class="fa-fw fa fa-book"></i>Docs</a></li>
                <li><a href="https://jd.spongepowered.org"><i class="fa-fw fa fa-graduation-cap"></i>Javadocs</a></li>
                <li><a href="https://forums.spongepowered.org/c/plugins/plugin-releases"><i class="fa-fw fa fa-plug"></i>Plugins</a></li>
                <li><a href="https://ore.spongepowered.org"><img src="../../_static/ore.svg" alt="" class="fa-fw fa ore-logo">Ore <sup>Beta</sup></a></li>
                <li><a href="https://www.spongepowered.org/downloads"><i class="fa-fw fa fa-download"></i>Downloads</a></li>
                <li><a href="https://www.spongepowered.org/chat"><i class="fa-fw fa fa-comment"></i>Chat</a></li>
            </ul>
        </div>
    </div>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../server/index.html">Créer un Serveur</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions/index.html">Stratégie de versioning</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../preparing/index.html">Préparation pour le développement</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Création d’un Plugin</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-versions.html">Versions de l’API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buildsystem.html">Build Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workspace/index.html">Mise en Place de votre Espace de Travail</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/index.html">Configurer Votre Projet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-identifier.html">Identifiants de Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-class.html">Classe Principale du Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lifecycle.html">Cycle de vie des Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../injection.html">Injection de Dépendances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../practices/index.html">Bonnes Pratiques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optional/index.html">Optionnels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Journalisation (Logging) et Débogage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../text/index.html">Text</a></li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Commandes de Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event/index.html">Événements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">Configuration des plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assets.html">L’API des Ressources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html">La Data API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blocks/index.html">Blocs</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Entités</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="spawning.html">Invoquer une Entité</a></li>
<li class="toctree-l3"><a class="reference internal" href="modifying.html">Modification d’une entité</a></li>
<li class="toctree-l3"><a class="reference internal" href="ai.html">IA d’Entité</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Implémenter Vos Propres AITasks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../items/index.html">Items</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trade-offers.html">Trade-Offers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../effects.html">Effets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html">Scheduler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services.html">Services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database.html">Bases de données</a></li>
<li class="toctree-l2"><a class="reference internal" href="../permissions.html">Permissions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bans.html">Bans</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">Collection de Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bookview.html">Views d’un Livre</a></li>
<li class="toctree-l2"><a class="reference internal" href="../economy/index.html">Économie</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wgen/index.html">Génération du monde</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manager.html">Gestionnaire de Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../game-profile-manager.html">Gestionnaire de Profil de Jeu</a></li>
<li class="toctree-l2"><a class="reference internal" href="../offline-userplayer-data.html">Données du Joueur Hors-Ligne</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tab-lists.html">Tab Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-meta.html">Plugin Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ray-tracing.html">Ray Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging.html">Debugging d’un plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html">Tutoriels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/index.html">Plugins dépendants des implémentations</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ore/index.html">Documentation d’Ore</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contribuer à Sponge</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">À propos du Projet Sponge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Sponge</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">

 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
          <li><a href="../index.html">Création d’un Plugin</a> &raquo;</li>
          <li><a href="index.html">Entités</a> &raquo;</li>
    <li>Implémenter Vos Propres AITasks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plugin/entities/custom-ai.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
  <div class="section" id="implement-your-own-aitasks">
<h1>Implémenter Vos Propres AITasks<a class="headerlink" href="#implement-your-own-aitasks" title="Lien permanent vers ce titre">¶</a></h1>
<p>Avant de commencer à implémenter notre propre <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/entity/ai/task/AITask.html">AITask</a> nous devons nous assurer que notre espace de travail est configuré correctement. Merci de suivre les instructions dans <a class="reference internal" href="../internals/mcp-setup.html"><span class="doc">Utiliser MCP dans les Plugins</span></a>.</p>
<p>Voici une liste d’imports que nous aloons utiliser lors de l’implémentation de l”<code class="docutils literal notranslate"><span class="pre">AITask</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Comparator</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.function.Predicate</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.spongepowered.api.GameRegistry</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.ai.task.AITask</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.ai.task.AITaskType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.ai.task.AbstractAITask</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.living.Agent</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.flowpowered.math.vector.Vector3d</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.base.Preconditions</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">net.minecraft.entity.EntityLiving</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">net.minecraft.entity.ai.EntityAIBase</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">net.minecraft.pathfinding.PathNavigate</span><span class="p">;</span>
</pre></div>
</div>
<p>Pour simplifier l’implémentation, nous utilisons les constantes suivantes. Elles sont optionnelles et peuvent être facilement remplacées par des champs dynamiques définis via un constructeur.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">MOVEMENT_SPEED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">APPROACH_DISTANCE_SQUARED</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">double</span> <span class="n">MAX_DISTANCE_SQUARED</span> <span class="o">=</span> <span class="mi">20</span> <span class="o">*</span> <span class="mi">20</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">float</span> <span class="n">EXECUTION_CHANCE</span> <span class="o">=</span> <span class="mf">0.2F</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">MUTEX_FLAG_MOVE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Minecraft bit flag</span>
</pre></div>
</div>
<p>Si vous souhaitez implémenter votre propre <code class="docutils literal notranslate"><span class="pre">AITask</span></code>, alors vous devez hériter de <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/entity/ai/task/AbstractAITask.html">AbstractAITask</a> avec votre tâche. L’exemple suivant montre un exemple d’implémentation d’une telle AITask personnalisée. Également, nous devons générer un nouveau <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/entity/ai/task/AITaskType.html">AITaskType</a> pour notre <code class="docutils literal notranslate"><span class="pre">AITask</span></code>. Afin d’éviter de propager la logique partout, nous créons simplement un champs static et une méthode <code class="docutils literal notranslate"><span class="pre">register</span></code> pour ça dans la classe elle-même, comme montré par l’exemple de code suivant :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CreepyCompanionAITask</span> <span class="kd">extends</span> <span class="n">AbstractAITask</span><span class="o">&lt;</span><span class="n">Agent</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">AITaskType</span> <span class="n">TYPE</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">register</span><span class="p">(</span><span class="kd">final</span> <span class="n">Object</span> <span class="n">plugin</span><span class="p">,</span> <span class="kd">final</span> <span class="n">GameRegistry</span> <span class="n">gameRegistry</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TYPE</span> <span class="o">=</span> <span class="n">gameRegistry</span>
                <span class="p">.</span><span class="na">registerAITaskType</span><span class="p">(</span><span class="n">plugin</span><span class="p">,</span> <span class="s">&quot;creepy_companion&quot;</span><span class="p">,</span> <span class="s">&quot;CreepyCompanion&quot;</span><span class="p">,</span> <span class="n">CreepyCompanionAITask</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">[</span><span class="p">...</span><span class="o">]</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Bien sûr, nous avons toujours besoin d’appeler cette méthode depuis notre classe principale, mais cela peut être facilement fait de cette manière :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Listener</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onInitialize</span><span class="p">(</span><span class="kd">final</span> <span class="n">GameInitializationEvent</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CreepyCompanionAITask</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">game</span><span class="p">.</span><span class="na">getRegistry</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Après cela, nous pouvons finalement commencer à implémenter l’AITask. Pour cela, nous devons implémenter un total de sept méthodes et un constructeur :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">CreepyCompanionAITask(...)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">boolean</span> <span class="pre">canRunConcurrentWith(AITask&lt;Agent&gt;)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">boolean</span> <span class="pre">canBeInterrupted()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">boolean</span> <span class="pre">shouldUpdate()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">start()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">boolean</span> <span class="pre">continueUpdating()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">update()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">reset()</span></code></li>
</ul>
<p>L’image suivante décrit à peu près l’ordre d’exécution des méthodes :</p>
<img alt="The method execution order of the ai task" class="align-center" src="../../_images/ai-execution-order.png" />
<p>Nous avons besoin du constructeur pour définir tous les paramètres que nous voulons que notre <code class="docutils literal notranslate"><span class="pre">AITask</span></code> ait et configurer quelques options de base pour cela. Dans ce cas, il définit le <code class="docutils literal notranslate"><span class="pre">AITaskType</span></code> et configure le mutex de bits, ainsi qu’un <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Predicate.html">Predicate</a> <code class="docutils literal notranslate"><span class="pre">entityFilter</span></code> que nous utiliserons plus tard.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">final</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entityFilter</span><span class="p">;</span>

<span class="kd">private</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">optTarget</span><span class="p">;</span>

<span class="kd">public</span> <span class="nf">CreepyCompanionAITask</span><span class="p">(</span><span class="kd">final</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span> <span class="n">entityFilter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">super</span><span class="p">(</span><span class="n">TYPE</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="na">entityFilter</span> <span class="o">=</span> <span class="n">Preconditions</span><span class="p">.</span><span class="na">checkNotNull</span><span class="p">(</span><span class="n">entityFilter</span><span class="p">);</span>
    <span class="p">((</span><span class="n">EntityAIBase</span><span class="p">)</span> <span class="p">(</span><span class="n">Object</span><span class="p">)</span> <span class="k">this</span><span class="p">).</span><span class="na">setMutexBits</span><span class="p">(</span><span class="n">MUTEX_FLAG_MOVE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Malheureusement, nous devons recourir à des conversions sales vers les classes de Minecraft. C’est également la raison pour laquelle nous devons mettre en place notre espace de travail avec les mappings MCP.</p>
<p>Après cela, nous continuons aveec la première série de méthodes : <code class="docutils literal notranslate"><span class="pre">canRunConcurrentWith</span></code> et <code class="docutils literal notranslate"><span class="pre">canBeInterrupted</span></code>. Elles sont très simples à implémenter. Pour la première nous alons dépendre de la logique de Minecraft par défaut, mais cela requiert encore une fois des casts sales. Pour la deuxième, nous devons juste considérer si il peut être interrompu ou doit être complété d’abord.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canRunConcurrentWith</span><span class="p">(</span><span class="kd">final</span> <span class="n">AITask</span><span class="o">&lt;</span><span class="n">Agent</span><span class="o">&gt;</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(((</span><span class="n">EntityAIBase</span><span class="p">)</span> <span class="p">(</span><span class="n">Object</span><span class="p">)</span> <span class="k">this</span><span class="p">).</span><span class="na">getMutexBits</span><span class="p">()</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">EntityAIBase</span><span class="p">)</span> <span class="n">other</span><span class="p">).</span><span class="na">getMutexBits</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">canBeInterrupted</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Avec cela, nous avons tout ce dont nous avons besoin pour mettre de la logique personnalisée dans notre <code class="docutils literal notranslate"><span class="pre">AITask</span></code>. À savoir, la logique de quand commencer et de quoi faire dans ce cas. Nous commençons avec la vérification de si la tâche doit être exécutée. C’est également fait en deux étapes :</p>
<ul class="simple">
<li>Vérifier une chance d’exécution aléatoire</li>
<li>Chercher une cible appropriée</li>
</ul>
<p>L’exécution actuelle fait alors simplement la chose désirée avec la cible que nous avons trouvé.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldUpdate</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="n">Agent</span> <span class="n">owner</span> <span class="o">=</span> <span class="n">getOwner</span><span class="p">().</span><span class="na">get</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">owner</span><span class="p">.</span><span class="na">getRandom</span><span class="p">().</span><span class="na">nextFloat</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">EXECUTION_CHANCE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">final</span> <span class="n">Vector3d</span> <span class="n">position</span> <span class="o">=</span> <span class="n">getPositionOf</span><span class="p">(</span><span class="n">owner</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="na">optTarget</span> <span class="o">=</span> <span class="n">owner</span><span class="p">.</span><span class="na">getWorld</span><span class="p">()</span>
            <span class="p">.</span><span class="na">getEntities</span><span class="p">().</span><span class="na">stream</span><span class="p">()</span>
            <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">entityFilter</span><span class="p">)</span>
            <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">getPositionOf</span><span class="p">(</span><span class="n">e</span><span class="p">).</span><span class="na">distanceSquared</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MAX_DISTANCE_SQUARED</span><span class="p">)</span>
            <span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">Comparator</span><span class="p">.</span><span class="na">comparingDouble</span><span class="p">(</span><span class="n">e</span> <span class="o">-&gt;</span> <span class="n">getPositionOf</span><span class="p">(</span><span class="n">e</span><span class="p">).</span><span class="na">distanceSquared</span><span class="p">(</span><span class="n">position</span><span class="p">)));</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">optTarget</span><span class="p">.</span><span class="na">isPresent</span><span class="p">();</span>
<span class="p">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">getNavigator</span><span class="p">().</span><span class="na">tryMoveToEntityLiving</span><span class="p">((</span><span class="n">net</span><span class="p">.</span><span class="na">minecraft</span><span class="p">.</span><span class="na">entity</span><span class="p">.</span><span class="na">Entity</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="na">optTarget</span><span class="p">.</span><span class="na">get</span><span class="p">(),</span> <span class="n">MOVEMENT_SPEED</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Le <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Random.html">Random</a> du propriétaire est généralemeent une bonne source d’aléa dans ces tâches, mais n’importe quel <code class="docutils literal notranslate"><span class="pre">Random</span></code> pourrait également fonctionner. La seule raison pour laquellee l”<a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/entity/Entity.html">Entity</a> a un random est pour éviter d’avoir un <code class="docutils literal notranslate"><span class="pre">Random</span></code> dans chaque classe qui interagit avec l’entité.</p>
<p>La recherche de la cible est assez simple. Tout d’abord, nous devons récupérer toutes les entités du monde dans lequel l’entité est actuellement, et ensuite nous filtrons cette liste en utilisant le <code class="docutils literal notranslate"><span class="pre">Predicate</span></code> <code class="docutils literal notranslate"><span class="pre">entityFilter</span></code> que nous avons défini dans le constructeur. Après ça, nous supprimons toutes les entités qui sont trop loin. C’est 20 blocs, mais vous pouvez augmenter cette distance. Gardez à l’esprit qu’en élargissant la distance, vous augmentez également le temps de calcul nécessaire pour la recherche de chemin.</p>
<p>Après avoir trouvé notre cible, nous avons juste à dire à l’entité de se déplacer vers elle. La vitesse est un facteur très important pour ça, si la vitesse est trop rapide, alors l’entité pourrait accidentellement rater la cible et finir par courir en avant et en arrière pour toujours (donc soyez sûr d’avoir calculé les critères d’acceptation correctement). Si la vitesse est trop lente, alors l’entité bougera à peine (ce qui semblera étrange et rendra des tâches comme «&nbsp;suivre X&nbsp;» ridicules).</p>
<p>Le code ci-dessus contient quelques appels de méthodes qui ont été ajoutées afin d’améliorer la lisibilité du code; le bloc de code suivant montre quelques méthodes utiles :</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">Vector3d</span> <span class="nf">getPositionOf</span><span class="p">(</span><span class="kd">final</span> <span class="n">Entity</span> <span class="n">entity</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">entity</span><span class="p">.</span><span class="na">getLocation</span><span class="p">().</span><span class="na">getPosition</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="n">PathNavigate</span> <span class="nf">getNavigator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">EntityLiving</span><span class="p">)</span> <span class="p">(</span><span class="n">getOwner</span><span class="p">().</span><span class="na">get</span><span class="p">())).</span><span class="na">getNavigator</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La première méthode appelle simplement quelques méthodes en une seule fois, l’autre récupère le <code class="docutils literal notranslate"><span class="pre">PathNavigate</span></code> ou le contrôleur de mouvement depuis l’entité, ce qui requiert de cast vers les classes de Minecraft.</p>
<p>La dernière partie que nous devons implémenter est la vérification de sie la tâche doit continuer de tourner et ce qui doit être fait pour ça.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">continueUpdating</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">getNavigator</span><span class="p">().</span><span class="na">noPath</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="na">optTarget</span><span class="p">.</span><span class="na">isPresent</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">final</span> <span class="n">Entity</span> <span class="n">target</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">optTarget</span><span class="p">.</span><span class="na">get</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">getPositionOf</span><span class="p">(</span><span class="n">target</span><span class="p">).</span><span class="na">distanceSquared</span><span class="p">(</span><span class="n">getPositionOf</span><span class="p">(</span><span class="n">getOwner</span><span class="p">().</span><span class="na">get</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="n">APPROACH_DISTANCE_SQUARED</span><span class="p">;</span>
<span class="p">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">getNavigator</span><span class="p">().</span><span class="na">clearPath</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="na">optTarget</span> <span class="o">=</span> <span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pour notre <code class="docutils literal notranslate"><span class="pre">AITask</span></code> c’est très simple. Tout d’abord, nous devons vérifier si l’entité a perdu son chemin et puis si l’entité est assez proche. Si nous retournons <code class="docutils literal notranslate"><span class="pre">false</span></code>, alors Minecraft va invoquer la méthode <code class="docutils literal notranslate"><span class="pre">reset()</span></code> ensuite. Là nous devons effectuer un peu de nettoyage. En particulier, la référence vers l’entité doit être nettoyé, sinon nous risquons d’avoir une fuite de mémoire. Si nous retournonss <code class="docutils literal notranslate"><span class="pre">true</span></code>, alors Minecraft va invoquer <code class="docutils literal notranslate"><span class="pre">update()</span></code>, ce qui ne fait rien dans notre cas car le contrôleur de mouvement fonctionne indépendamment de l’IA et l’entité va continuer de marcher vers la cible.</p>
<p>C’est tout ce qu’il faut pour écrire des <code class="docutils literal notranslate"><span class="pre">AITask</span></code>s personnalisées. Maintenant nous pouvons l’utiliser à l’intérieur d’une <code class="docutils literal notranslate"><span class="pre">Entity</span></code>, et le chapitre «&nbsp;Ajout d’AITasks Supplémentaires&nbsp;» sur la page <a class="reference internal" href="ai.html"><span class="doc">IA d’Entité</span></a> explique comment le faire.</p>
<p>Mais pourquoi avons nous appelé cette tâche <code class="docutils literal notranslate"><span class="pre">CreepyCompanionAITask</span></code> ? Il y a une solution simple pour ça. Lors de la vérification de si l”<code class="docutils literal notranslate"><span class="pre">AITask</span></code> doit être exécutée, on ne vérifie pas si l’entité est déjà assez proche, donc elle bougera un petit peu vers la cible à chaque fois. La prochaine étape dans l’horreur serait pobablement que l’entité fasses seulement ceci si la cible ne regarde pas. Imaginez un creeper s’approchant lentement dans votre dos.</p>
</div>

           </div>
          </div>
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../items/index.html" class="btn btn-neutral float-right" title="Items" accesskey="n" rel="next">Suivant <span class="fa fa-angle-right"></span></a>
        <a href="ai.html" class="btn btn-neutral" title="IA d’Entité" accesskey="p" rel="prev"><span class="fa fa-angle-left"></span> Précédent</a>
    </div>

    <hr/>

    <section id="license-footer">
        <p>Except where otherwise noted,
            <a xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" property="dct:title" rel="cc:attributionURL" href="https://github.com/SpongePowered/SpongeDocs">SpongeDocs</a>
            is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </p>
        <a id="license-icons" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" title="CC-BY-SA" aria-hidden="true">cba</a>
    </section>
</footer>        </div>
      </div>

    </section>

  </div>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <i class="fa fa-book"> <span>SpongeDocs</span></i>
        v: 7.2.0
    <img src="../../_static/flags/fr_FR.svg"
         alt="fr" title="Français">
        <span class="fa fa-caret-down"></span>
    </span>
    <div id="versions" class="rst-other-versions">




    </div>
</div>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'7.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>      <script type="text/javascript" src="../../_static/jquery.js"></script>      <script type="text/javascript" src="../../_static/underscore.js"></script>      <script type="text/javascript" src="../../_static/doctools.js"></script>      <script type="text/javascript" src="../../_static/language_data.js"></script>      <script type="text/javascript" src="../../_static/translations.js"></script>      <script type="text/javascript" src="../../_static/spongedocs.js"></script>

    <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
 
</body>
</html>