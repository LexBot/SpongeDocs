
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canales de Mensajes &mdash; documentación de Sponge - 7.2.0</title>

    <link rel="shortcut icon" href="../../_static/favicon.ico"/>




    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    <link rel="stylesheet" href="../../_static/spongedocs.css" type="text/css" />

        <link rel="index" title="Índice"
              href="../../genindex.html"/>        <link rel="search" title="Búsqueda" href="../../search.html"/>    <link rel="top" title="documentación de Sponge - 7.2.0" href="../../index.html"/>        <link rel="up" title="Texto" href="index.html"/>        <link rel="next" title="TextTemplates" href="templates.html"/>        <link rel="prev" title="El Servicio de Paginación" href="pagination.html"/>
    <!-- Google Analytics -->
    <script>
        (function(S,p,o,n,g,i,e){S['GoogleAnalyticsObject']=g;S[g]=S[g]||function(){
        (S[g].q=S[g].q||[]).push(arguments)},S[g].l=1*new Date();i=p.createElement(o),
        e=p.getElementsByTagName(o)[0];i.async=1;i.src=n;e.parentNode.insertBefore(i,e)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-59476017-2', 'auto');
        ga('send', 'pageview');
    </script>

  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
    <div id="sp-logo-container" class="page-scroll">
        <a class="logo" href="../../index.html">
            <img src="../../_static/spongie-mark-dark.svg">
            <span>Sponge</span>
            <i class="fa fa-fw fa-chevron-down"></i>
        </a>
        <div id="sp-logo-menu">
            <ul id="sp-logo-dropdown">
                <li><a href="https://www.spongepowered.org"><i class="fa-fw fa fa-home"></i>Homepage</a></li>
                <li><a href="https://forums.spongepowered.org"><i class="fa-fw fa fa-comments"></i>Forums</a></li>
                <li><a href="https://github.com/SpongePowered"><i class="fa-fw fa fa-code"></i>Code</a></li>
                <li class="active"><a href="https://docs.spongepowered.org"><i class="fa-fw fa fa-book"></i>Docs</a></li>
                <li><a href="https://jd.spongepowered.org"><i class="fa-fw fa fa-graduation-cap"></i>Javadocs</a></li>
                <li><a href="https://forums.spongepowered.org/c/plugins/plugin-releases"><i class="fa-fw fa fa-plug"></i>Plugins</a></li>
                <li><a href="https://ore.spongepowered.org"><img src="../../_static/ore.svg" alt="" class="fa-fw fa ore-logo">Ore <sup>Beta</sup></a></li>
                <li><a href="https://www.spongepowered.org/downloads"><i class="fa-fw fa fa-download"></i>Downloads</a></li>
                <li><a href="https://www.spongepowered.org/chat"><i class="fa-fw fa fa-comment"></i>Chat</a></li>
            </ul>
        </div>
    </div>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../server/index.html">Creando un Servidor</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions/index.html">Versioning Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../preparing/index.html">Preparándose para el Desarrollo</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Creando un Plugin</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api-versions.html">API-Versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../buildsystem.html">Sistemas de Compilación</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workspace/index.html">Configuración de su Espacio de Trabajo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/index.html">Configurando Su Proyecto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-identifier.html">Identificadores de Complementos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-class.html">Clase de Plug-in Principal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lifecycle.html">Ciclo de vida del Plugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../injection.html">Inyección de Dependencia</a></li>
<li class="toctree-l2"><a class="reference internal" href="../practices/index.html">Prácticas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optional/index.html">Opcionales</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Registro y Depuración</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Texto</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="text.html">Creación de Texto</a></li>
<li class="toctree-l3"><a class="reference internal" href="representations/index.html">Serializadores de Texto</a></li>
<li class="toctree-l3"><a class="reference internal" href="pagination.html">El Servicio de Paginación</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Canales de Mensajes</a></li>
<li class="toctree-l3"><a class="reference internal" href="templates.html">TextTemplates</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../commands/index.html">Plugin Commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../event/index.html">Eventos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../configuration/index.html">Configurando Extensiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../assets.html">La API de Activos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data/index.html">La API de Datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../blocks/index.html">Bloques</a></li>
<li class="toctree-l2"><a class="reference internal" href="../entities/index.html">Entidades</a></li>
<li class="toctree-l2"><a class="reference internal" href="../items/index.html">Articulos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../trade-offers.html">Ofertas de Intercambio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../effects.html">Efectos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scheduler.html">Programador</a></li>
<li class="toctree-l2"><a class="reference internal" href="../services.html">Servicios</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database.html">Bases de datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../permissions.html">Permisos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bans.html">Baneos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics.html">Metrics Collection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bookview.html">Vistas del Libro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../economy/index.html">Economía</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wgen/index.html">Generación de Mundo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../manager.html">Administrador de Complementos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../game-profile-manager.html">Administrador de Perfiles del Juego</a></li>
<li class="toctree-l2"><a class="reference internal" href="../offline-userplayer-data.html">Datos del Jugador Fuera de Línea</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tab-lists.html">Listas de Tabulaciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugin-meta.html">Metadatos del Complemento</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ray-tracing.html">Trazado de Rayos (Ray Tracing)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../debugging.html">Depuración de Complemento</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials.html">Tutoriales</a></li>
<li class="toctree-l2"><a class="reference internal" href="../internals/index.html">Implementation-dependent Plugins</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ore/index.html">Documentación Ore</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contribuyendo a Sponge</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">Acerca del proyecto Sponge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Sponge</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">

 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
          <li><a href="../index.html">Creando un Plugin</a> &raquo;</li>
          <li><a href="index.html">Texto</a> &raquo;</li>
    <li>Canales de Mensajes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/plugin/text/messagechannels.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
  <div class="section" id="message-channels">
<h1>Canales de Mensajes<a class="headerlink" href="#message-channels" title="Enlazar permanentemente con este título">¶</a></h1>
<p>En Sponge, todos los objetos a los que se envían mensajes implementan la interfaz <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageReceiver.html">MessageReceiver</a>. Un <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html">MessageChannel</a> es un dispositivo que puede enviar mensajes a un número arbitrario de <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code>s e incluso realizar acciones como destinatario específico del mensaje.</p>
<div class="section" id="selecting-message-recipients">
<h2>Selección de Destinatario de Mensajes<a class="headerlink" href="#selecting-message-recipients" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Dentro de la interfaz de <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> hay constantes y métodos estáticos que pueden ser utilizados para obtener o crear los canales utilizados comúnmente. Hay también otras clases e interfaces que pueden utilizarse para crear un <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>, como por ejemplo <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/AbstractMutableMessageChannel.html">AbstractMutableMessageChannel</a> y <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html">MutableMessageChannel</a>. Una lista completa de esto puede encontrarse en <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/package-summary.html">org.spongepowered.api.text.channel</a> y sus subpaquetes.</p>
<div class="section" id="broadcasting">
<h3>Transmisión<a class="headerlink" href="#broadcasting" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El canal más común será el canal de transmisión. Esto puede ser obtenido desde <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/Server.html">Server</a> a través del método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/Server.html#getBroadcastChannel--">Server#getBroadcastChannel()</a> o desde la constante <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#TO_PLAYERS">MessageChannel#TO_PLAYERS</a> o <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#TO_ALL">MessageChannel#TO_ALL</a>. La única diferencia es que <code class="docutils literal notranslate"><span class="pre">TO_ALL</span></code> incluye no solo a todos los jugadores conectados al servidor sino también a al servidor <code class="docutils literal notranslate"><span class="pre">Consola</span></code>.</p>
<p>El canal devuelto por <code class="docutils literal notranslate"><span class="pre">getBroadcastChannel()</span></code> generalmente será el canal <code class="docutils literal notranslate"><span class="pre">MessageChannel.TO_ALL</span></code>, sin embargo un canal diferente puede establecerse utilizando el método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/Server.html#setBroadcastChannel-org.spongepowered.api.text.channel.MessageChannel-">Server#setBroadcastChannel(MessageChannel)</a>.</p>
</div>
<div class="section" id="sending-to-a-fixed-list-of-messagereceivers">
<h3>Envío a una Lista Fija de MessageReceivers<a class="headerlink" href="#sending-to-a-fixed-list-of-messagereceivers" title="Enlazar permanentemente con este título">¶</a></h3>
<p>También es posible enviar un mensaje no a todos los jugadores conectados, sino a un número de destinatarios seleccionados a mano. Esto puede ser hecho pasando la lista de los destinatarios al método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#fixed-org.spongepowered.api.text.channel.MessageReceiver...-">MessageChannel#fixed(MessageReceiver…)</a>. A diferencia de la mayoría de los otros canales, la lista de destinatarios no será generada dinámicamente cada vez que algo se envíe a través del canal sino que permanece estática por el resto de su existencia. Sin embargo, las referencias que se mantienen son <em>débiles</em>. Esto significa que si por ejemplo un jugador se desconecta y el correspondiente objeto <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/entity/living/player/Player.html">Player</a> es removido por el <em>basurero</em> de Java, ese jugador también desaparecerá de la lista de de destinatarios del canal.</p>
</div>
<div class="section" id="permission-based-selection">
<h3>Selección basada en Permisos<a class="headerlink" href="#permission-based-selection" title="Enlazar permanentemente con este título">¶</a></h3>
<p>También es posible crear un envío de canal a todos los destinatarios que tienen un permiso específico. El canal es obtenido desde el método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#permission-java.lang.String-">MessageChannel#permission(String)</a> con el permiso para verificar como un argumento. Cuando un mensaje es enviado a través de este canal, se obtendrán todos los temas desde el <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/service/permission/PermissionService.html">PermissionService</a> que tienen el permiso dado.</p>
</div>
<div class="section" id="combining-channels">
<h3>Combinación de Canales<a class="headerlink" href="#combining-channels" title="Enlazar permanentemente con este título">¶</a></h3>
<p>También se pueden combinar múltiples canales en uno. Esto puede hacerse pasando todos los canales al método :javadoc:<a href="#id1"><span class="problematic" id="id2">`</span></a>MessageChannel#combined(MessageChannel…). El canal resultante retransmitirá los mensajes a cada destinatario que sea el objetivo de al menos uno de los canales combinados.</p>
</div>
</div>
<div class="section" id="sending-messages">
<h2>Envío de Mensajes<a class="headerlink" href="#sending-messages" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Una vez que ha obtenido un <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> puede enviar un mensaje a través del método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#send-java.lang.Object-org.spongepowered.api.text.Text-">MessageChannel#send(Object, Text)</a>. Este método es preferido sobre el método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#send-org.spongepowered.api.text.Text-">MessageChannel#send(Text)</a>, ya que el <code class="docutils literal notranslate"><span class="pre">Objecto</span></code> puede ser utilizado para la identificación o para realizar otras acciones diferentes. Alternativamente, puede utilizar un <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/chat/ChatType.html">ChatType</a> para especificar a donde los mensajes serán enviados. Utilizando el método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#send-java.lang.Object-org.spongepowered.api.text.Text-org.spongepowered.api.text.chat.ChatType-">MessageChannel#send(Object, Text, ChatType)</a> le permitirá lograr esto. El canal después transformará el mensaje para cada destinatarios y enviará el mensaje transformado.</p>
<div class="section" id="extended-application-chat-channels">
<h3>Aplicación Extendida: Canales de Chat<a class="headerlink" href="#extended-application-chat-channels" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los canales de mensaje tienen una aplicación muy útil ya que pueden ser utilizados para establecer canales de chat. Por ejemplo, puede establecer un mensaje de chat para cada canal de chat que desee tener. Entonces, cuando un <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code> se une a un canal, como un <code class="docutils literal notranslate"><span class="pre">/join</span> <span class="pre">&lt;channel</span> <span class="pre">name&gt;</span></code>, simplemente configure el <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> del <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code> en el canal apropiado utilizando <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageReceiver.html#setMessageChannel-org.spongepowered.api.text.channel.MessageChannel-">MessageReceiver#setMessageChannel(MessageChannel)</a>. Esto causará que cada mensaje enviado <em>desde</em> el <code class="docutils literal notranslate"><span class="pre">MessageReceiver</span></code> para ser pasado al <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> dado en lugar del predeterminado. Alternativamente, puede escuchar <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/event/message/MessageChannelEvent.html">MessageChannelEvent</a>, y configurar el apropiado <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> utilizando <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/event/message/MessageChannelEvent.html#setChannel-org.spongepowered.api.text.channel.MessageChannel-">MessageChannelEvent#setChannel(MessageChannel)</a>. Pasarle <code class="docutils literal notranslate"><span class="pre">nulo</span></code> a ese método desconfigurará cualquier canal personalizado, causando que el mensaje sea enviado al MessageChannel original en su lugar.</p>
</div>
</div>
<div class="section" id="transforming-messages">
<h2>Transformación de Mensajes<a class="headerlink" href="#transforming-messages" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Puede aplicar un filtro a todos los <code class="docutils literal notranslate"><span class="pre">Texto</span></code>s que pasen a través de un <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> para cambiar el mensaje como prefiera. Esto es posible extendiendo el <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> y remplazando el método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#transformMessage-java.lang.Object-org.spongepowered.api.text.channel.MessageReceiver-org.spongepowered.api.text.Text-org.spongepowered.api.text.chat.ChatType-">MessageChannel#transformMessage(Object, MessageReceiver, Text, ChatType)</a> como se demostrará a continuación.</p>
<p><strong>Ejemplo: Transformación de Mensajes</strong></p>
<p>El siguiente fragmento de código define una clase de <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code> que reemplaza el método predeterminado <code class="docutils literal notranslate"><span class="pre">transformMessage</span></code>. El nuevo método <code class="docutils literal notranslate"><span class="pre">transformMessage</span></code> tomará el mensaje original y anexará una etiqueta roja <code class="docutils literal notranslate"><span class="pre">[Admin]</span></code> al frente del mensaje.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.Text</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageChannel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.chat.ChatType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.format.TextColors</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminMessageChannel</span> <span class="kd">implements</span> <span class="n">MessageChannel</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Text</span><span class="o">&gt;</span> <span class="nf">transformMessage</span><span class="p">(</span><span class="n">Object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MessageReceiver</span> <span class="n">recipient</span><span class="p">,</span>
                <span class="n">Text</span> <span class="n">original</span><span class="p">,</span> <span class="n">ChatType</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">TextColors</span><span class="p">.</span><span class="na">RED</span><span class="p">,</span> <span class="s">&quot;[Admin]&quot;</span><span class="p">,</span> <span class="n">TextColors</span><span class="p">.</span><span class="na">RESET</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="nf">getMembers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">emptyList</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Tenga en cuenta que no se desea definir ningún destinatario adicional, por lo que devolveremos una colección vacía en el método <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MessageChannel.html#getMembers--">MessageChannel#getMembers()</a>.</p>
<p>Gracias a las capacidades de combinar <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>s, podemos combinar nuestro recién creado <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code> con cualquier otro <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>. Ahora si un jugador se une con el permiso <code class="docutils literal notranslate"><span class="pre">myplugin.admin</span></code>, obtendremos el <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code> al que sus mensajes son enviados, lo combinaremos con un <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code> y estbleceremos el canal combinado de vuelta al jugador. De esa manera, todos sus mensajes son enviados a todas las personas especificadas en el canal original, pero debido a la adición del <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code>, una etiqueta roja <code class="docutils literal notranslate"><span class="pre">[Admin]</span></code> será prefijada.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.spongepowered.api.entity.living.player.Player</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.event.Listener</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.event.network.ClientConnectionEvent</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageChannel</span><span class="p">;</span>

<span class="kd">private</span> <span class="n">AdminMessageChannel</span> <span class="n">adminChannel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AdminMessageChannel</span><span class="p">();</span>

<span class="nd">@Listener</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onClientConnectionJoin</span><span class="p">(</span><span class="n">ClientConnectionEvent</span><span class="p">.</span><span class="na">Join</span> <span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Player</span> <span class="n">player</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="na">getTargetEntity</span><span class="p">();</span>
    <span class="k">if</span><span class="p">(</span><span class="n">player</span><span class="p">.</span><span class="na">hasPermission</span><span class="p">(</span><span class="s">&quot;myplugin.admin&quot;</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">MessageChannel</span> <span class="n">originalChannel</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="na">getOriginalChannel</span><span class="p">();</span>
        <span class="n">MessageChannel</span> <span class="n">newChannel</span> <span class="o">=</span> <span class="n">MessageChannel</span><span class="p">.</span><span class="na">combined</span><span class="p">(</span><span class="n">originalChannel</span><span class="p">,</span>
            <span class="n">adminChannel</span><span class="p">);</span>
        <span class="n">player</span><span class="p">.</span><span class="na">setMessageChannel</span><span class="p">(</span><span class="n">newChannel</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Tenga en cuenta que serán prefijados los mensajes <cite>todos</cite> pertenecientes a un jugador. Esto incluye mensajes muertos, mensajes abandonados, etc. Si solo quiere prefijar todos los mensajes de <cite>chat</cite>, necesitará escuchar el <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/event/message/MessageChannelEvent.Chat.html">MessageChannelEvent.Chat</a> y establecer el canal en el evento en lugar del jugador. Esto se haría utilizando <code class="docutils literal notranslate"><span class="pre">event.setChannel(newChannel)</span></code> en el evento <code class="docutils literal notranslate"><span class="pre">MessageChannelEvent.Chat</span></code>. Para que el jugador del evento verifique los permisos, necesitará obtener un <code class="docutils literal notranslate"><span class="pre">Jugador</span></code> de la <code class="docutils literal notranslate"><span class="pre">Causa</span></code> del evento. Esto es demostrado a continuación:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span> <span class="n">playerOptional</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="na">getCause</span><span class="p">().</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span><span class="n">first</span><span class="p">(</span><span class="n">Player</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</pre></div>
</div>
<p>Más sobre causas puede encontrarlas en <a class="reference internal" href="../event/causes.html"><span class="doc">causes page</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Cuando se combinan múltiples <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>s definiendo diferentes transformaciones de mensajes, el <code class="docutils literal notranslate"><span class="pre">Texto</span></code> será transformado en el orden en que los <code class="docutils literal notranslate"><span class="pre">MessageChannel</span></code>s son transferidos al método <code class="docutils literal notranslate"><span class="pre">MessageChannel#combined(MessageChannel...</span> <span class="pre">channels)</span></code>. Tenga en cuenta que cualquier transformación que resulte en un vacío <code class="docutils literal notranslate"><span class="pre">Opcional</span></code> será ignorada a menos que sea realizada por el último canal en la cadena.</p>
</div>
</div>
<div class="section" id="mutable-message-channels">
<h2>Canales de Mensajes Mutables<a class="headerlink" href="#mutable-message-channels" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Un <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html">MutableMessageChannel</a> contiene métodos para cambiar quien puede recibir mensajes enviados a través de nuestro canal. Como tal, debemos implementar métodos para la realización de acciones que modifiquen nuestros miembros. Para hacer esto, simplemente crearemos una clase llamada <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code> que implementará un <code class="docutils literal notranslate"><span class="pre">MutableMessageChannel</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.WeakHashMap</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.Text</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MessageReceiver</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.channel.MutableMessageChannel</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.chat.ChatType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.api.text.format.TextColors</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MutableAdminMessageChannel</span> <span class="kd">implements</span> <span class="n">MutableMessageChannel</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="n">members</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">MutableAdminMessageChannel</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">(</span><span class="n">Collections</span><span class="p">.</span><span class="na">emptySet</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">MutableAdminMessageChannel</span><span class="p">(</span><span class="n">Collection</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="n">members</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">members</span> <span class="o">=</span> <span class="n">Collections</span><span class="p">.</span><span class="na">newSetFromMap</span><span class="p">(</span><span class="k">new</span> <span class="n">WeakHashMap</span><span class="o">&lt;&gt;</span><span class="p">());</span>
        <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">members</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">MessageReceiver</span><span class="o">&gt;</span> <span class="nf">getMembers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">unmodifiableSet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">addMember</span><span class="p">(</span><span class="n">MessageReceiver</span> <span class="n">member</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">member</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">removeMember</span><span class="p">(</span><span class="n">MessageReceiver</span> <span class="n">member</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">member</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clearMembers</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Text</span><span class="o">&gt;</span> <span class="nf">transformMessage</span><span class="p">(</span><span class="n">Object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MessageReceiver</span> <span class="n">recipient</span><span class="p">,</span>
                <span class="n">Text</span> <span class="n">original</span><span class="p">,</span> <span class="n">ChatType</span> <span class="n">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Text</span> <span class="n">text</span> <span class="o">=</span> <span class="n">original</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">members</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">recipient</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">TextColors</span><span class="p">.</span><span class="na">RED</span><span class="p">,</span> <span class="s">&quot;[Admin]&quot;</span><span class="p">,</span> <span class="n">TextColors</span><span class="p">.</span><span class="na">RESET</span><span class="p">,</span> <span class="n">text</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La principal diferencia entre nuestro <code class="docutils literal notranslate"><span class="pre">AdminMessageChannel</span></code> y nuestro nuevo <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code> es que verificaremos si el destinatario está en la lista de miembros antes de transformar el mensaje. Si es así, podemos alterar el mensaje que es enviado, anexando el prefijo en rojo <code class="docutils literal notranslate"><span class="pre">[Admin]</span></code>. En nuestro método <code class="docutils literal notranslate"><span class="pre">getMembers()</span></code> devolvemos un conjunto inmutable, de modo que el conjunto puede ser modificado solo por el método apropiado en nuestro <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code>.</p>
<p>Note that an abstract implementation for <code class="docutils literal notranslate"><span class="pre">MutableMessageChannel</span></code>s exists in SpongeAPI as
<code class="docutils literal notranslate"><span class="pre">AbstractMutableMessageChannel</span></code>. Also note that our members do not persist. If a player were to leave the server,
they would be removed from the set.</p>
<div class="section" id="modifying-the-members">
<h3>Modificación de los Miembros<a class="headerlink" href="#modifying-the-members" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Para hacer completo uso de nuestro <code class="docutils literal notranslate"><span class="pre">MutableAdminMessageChannel</span></code>, debemos poder agregar y eliminar miembros del canal. Para hacer esto, podemos simplemente llamar a nuestros métodos <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html#addMember-org.spongepowered.api.text.channel.MessageReceiver-">MutableMessageChannel#addMember(MessageReceiver)</a> y <a class="reference external" href="https://jd.spongepowered.org/7.2.0/org/spongepowered/api/text/channel/MutableMessageChannel.html#removeMember-org.spongepowered.api.text.channel.MessageReceiver-">MutableMessageChannel#removeMember(MessageReceiver)</a> que implementamos previamente cada vez que necesitamos agregar o eliminar un miembro del conjunto.</p>
</div>
</div>
</div>

           </div>
          </div>
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="templates.html" class="btn btn-neutral float-right" title="TextTemplates" accesskey="n" rel="next">Siguiente <span class="fa fa-angle-right"></span></a>
        <a href="pagination.html" class="btn btn-neutral" title="El Servicio de Paginación" accesskey="p" rel="prev"><span class="fa fa-angle-left"></span> Previo</a>
    </div>

    <hr/>

    <section id="license-footer">
        <p>Except where otherwise noted,
            <a xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" property="dct:title" rel="cc:attributionURL" href="https://github.com/SpongePowered/SpongeDocs">SpongeDocs</a>
            is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </p>
        <a id="license-icons" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" title="CC-BY-SA" aria-hidden="true">cba</a>
    </section>
</footer>        </div>
      </div>

    </section>

  </div>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <i class="fa fa-book"> <span>SpongeDocs</span></i>
        v: 7.2.0
    <img src="../../_static/flags/es_ES.svg"
         alt="es" title="Español">
        <span class="fa fa-caret-down"></span>
    </span>
    <div id="versions" class="rst-other-versions">




    </div>
</div>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'7.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>      <script type="text/javascript" src="../../_static/jquery.js"></script>      <script type="text/javascript" src="../../_static/underscore.js"></script>      <script type="text/javascript" src="../../_static/doctools.js"></script>      <script type="text/javascript" src="../../_static/language_data.js"></script>      <script type="text/javascript" src="../../_static/translations.js"></script>      <script type="text/javascript" src="../../_static/spongedocs.js"></script>

    <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
 
</body>
</html>