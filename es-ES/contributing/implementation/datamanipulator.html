
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Implementando DataManipulators &mdash; documentación de Sponge - 7.2.0</title>

    <link rel="shortcut icon" href="../../_static/favicon.ico"/>




    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    <link rel="stylesheet" href="../../_static/spongedocs.css" type="text/css" />

        <link rel="index" title="Índice"
              href="../../genindex.html"/>        <link rel="search" title="Búsqueda" href="../../search.html"/>    <link rel="top" title="documentación de Sponge - 7.2.0" href="../../index.html"/>        <link rel="up" title="Desarollando Sponge" href="index.html"/>        <link rel="next" title="Escritura de los Spongedocs" href="../spongedocs.html"/>        <link rel="prev" title="Mixins" href="mixins.html"/>
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
    <div id="sp-logo-container" class="page-scroll">
        <a class="logo" href="../../index.html">
            <img src="../../_static/spongie-mark-dark.svg">
            <span>Sponge</span>
            <i class="fa fa-fw fa-chevron-down"></i>
        </a>
        <div id="sp-logo-menu">
            <ul id="sp-logo-dropdown">
                <li><a href="https://www.spongepowered.org"><i class="fa-fw fa fa-home"></i>Homepage</a></li>
                <li><a href="https://forums.spongepowered.org"><i class="fa-fw fa fa-comments"></i>Forums</a></li>
                <li><a href="https://github.com/SpongePowered"><i class="fa-fw fa fa-code"></i>Code</a></li>
                <li class="active"><a href="https://docs.spongepowered.org"><i class="fa-fw fa fa-book"></i>Docs</a></li>
                <li><a href="https://jd.spongepowered.org"><i class="fa-fw fa fa-graduation-cap"></i>Javadocs</a></li>
                <li><a href="https://forums.spongepowered.org/c/plugins/plugin-releases"><i class="fa-fw fa fa-plug"></i>Plugins</a></li>
                <li><a href="https://ore.spongepowered.org"><img src="../../_static/ore.svg" alt="" class="fa-fw fa ore-logo">Ore <sup>Beta</sup></a></li>
                <li><a href="https://www.spongepowered.org/downloads"><i class="fa-fw fa fa-download"></i>Downloads</a></li>
                <li><a href="https://www.spongepowered.org/chat"><i class="fa-fw fa fa-comment"></i>Chat</a></li>
            </ul>
        </div>
    </div>

<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../server/index.html">Creando un Servidor</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../versions/index.html">Versioning Policy</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../preparing/index.html">Preparándose para el Desarrollo</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plugin/index.html">Creando un Plugin</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ore/index.html">Documentación Ore</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Contribuyendo a Sponge</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../guidelines.html">Pautas de Contribución</a></li>
<li class="toctree-l2"><a class="reference internal" href="../howtogit.html">Como usar Git(Hub)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Desarollando Sponge</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="codestyle.html">Estilo de Código</a></li>
<li class="toctree-l3"><a class="reference internal" href="git-implementation.html">Flujo de trabajo de Git para la API e implementaciones</a></li>
<li class="toctree-l3"><a class="reference internal" href="pr.html">Presentando una Solicitud de Extracción</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging/index.html">Debugging Sponge</a></li>
<li class="toctree-l3"><a class="reference internal" href="mixins.html">Mixins</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Implementando DataManipulators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../spongedocs.html">Escritura de los Spongedocs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../porting.html">Portando Sponge a Otras Plataformas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../versioning.html">Repository Branch Layout</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">Acerca del proyecto Sponge</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">Sponge</a>
      </nav>


      <div class="wy-nav-content">
        <div class="rst-content">

 

<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
          <li><a href="../index.html">Contribuyendo a Sponge</a> &raquo;</li>
          <li><a href="index.html">Desarollando Sponge</a> &raquo;</li>
    <li>Implementando DataManipulators</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/contributing/implementation/datamanipulator.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
  <div class="section" id="implementing-datamanipulators">
<h1>Implementando DataManipulators<a class="headerlink" href="#implementing-datamanipulators" title="Enlazar permanentemente con este título">¶</a></h1>
<p>Esta es una guía para los colaboradores que quieran ayudar con la implementación de la API de datos mediante la creación de DataManipulators. Puede encontrarse una lista actualizada de DataManipulators a aplicarse en el problema SpongeCommon #8 &lt;<a class="reference external" href="https://github.com/SpongePowered/SpongeCommon/issues/8">https://github.com/SpongePowered/SpongeCommon/issues/8</a>&gt;`_.</p>
<p>To fully implement a <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/DataManipulator.html">DataManipulator</a> these steps must be followed:</p>
<ol class="arabic simple">
<li>Poner en práctica la “” DataManipulator”” en sí</li>
<li>Implement the <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/ImmutableDataManipulator.html">ImmutableDataManipulator</a></li>
</ol>
<p>Cuando haya completado estos pasos, también debe hacer lo siguiente:</p>
<ol class="arabic simple" start="3">
<li>Register the <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/key/Key.html">Key</a> in the <code class="docutils literal notranslate"><span class="pre">KeyRegistryModule</span></code></li>
<li>Implemente el «DtaProcessor»</li>
<li>Implement the <code class="docutils literal notranslate"><span class="pre">ValueProcessor</span></code> for each <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/value/mutable/Value.html">Value</a> being represented by the <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code></li>
</ol>
<p>Si los datos se aplican a un bloque, varios métodos deben también ser mezclados al bloque.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Asegúrese de seguir nuestras :doc:”… /instrucciones.</p>
</div>
<p>The following snippet shows the imports/paths for some classes in SpongeCommon that you will need:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">org.spongepowered.common.data.DataProcessor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.data.ValueProcessor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.data.manipulator.immutable.entity.ImmutableSpongeHealthData</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.data.manipulator.mutable.common.AbstractData</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.data.manipulator.mutable.entity.SpongeHealthData</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.data.processor.common.AbstractEntityDataProcessor</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.util.Constants</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.data.util.NbtDataUtil</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.spongepowered.common.registry.type.data.KeyRegistryModule</span><span class="p">;</span>
</pre></div>
</div>
<div class="section" id="implement-the-datamanipulator">
<h2>1. implementar el DataManipulator<a class="headerlink" href="#implement-the-datamanipulator" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The naming convention for <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> implementations is the name of the interface prefixed with «Sponge».
So to implement the <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/mutable/entity/HealthData.html">HealthData</a> interface, we create a class named <code class="docutils literal notranslate"><span class="pre">SpongeHealthData</span></code> in the appropriate package.
For implementing the <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> first have it extend an appropriate abstract class from the
<code class="docutils literal notranslate"><span class="pre">org.spongepowered.common.data.manipulator.mutable.common</span></code> package. The most generic there is <code class="docutils literal notranslate"><span class="pre">AbstractData</span></code>
but there are also abstractions that reduce boilerplate code even more for some special cases like
<code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code>s only containing a single value.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpongeHealthData</span> <span class="kd">extends</span> <span class="n">AbstractData</span><span class="o">&lt;</span><span class="n">HealthData</span><span class="p">,</span> <span class="n">ImmutableHealthData</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">HealthData</span> <span class="p">{</span>
    <span class="o">[</span><span class="p">...</span><span class="o">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Hay dos argumentos de tipo para la clase de AbstractData. La primera es la interfaz implementada por esta clase, la segunda es la interfaz implementada por la correspondiente “”ImmutableDataManipulator””.</p>
<div class="section" id="the-constructor">
<h3>El Constructor<a class="headerlink" href="#the-constructor" title="Enlazar permanentemente con este título">¶</a></h3>
<p>En la mayoría de los casos mientras implementaba un resumen “” DataManipulator”” necesita de dos constructores:</p>
<ul class="simple">
<li>Uno sin argumentos (no-args) que llama al segundo constructor con valores «por defecto»</li>
<li>El segundo constructor toma todos los valores que soporta.</li>
</ul>
<p>El segundo constructor debe</p>
<ul class="simple">
<li>realizar una llamada al constructor de “” AbstractData””, pasando por la referencia de clase para la interfaz implementada.</li>
<li>asegúrese de que los valores pasados sean válidos</li>
<li>llame al método de “” registerGettersAndSetters()””</li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">com.google.common.base.Preconditions.checkArgument</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpongeHealthData</span> <span class="kd">extends</span> <span class="n">AbstractData</span><span class="o">&lt;</span><span class="n">HealthData</span><span class="p">,</span> <span class="n">ImmutableHealthData</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">HealthData</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kt">double</span> <span class="n">health</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kt">double</span> <span class="n">maxHealth</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">SpongeHealthData</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">(</span><span class="mi">20</span><span class="n">D</span><span class="p">,</span> <span class="mi">20</span><span class="n">D</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">SpongeHealthData</span><span class="p">(</span><span class="kt">double</span> <span class="n">health</span><span class="p">,</span> <span class="kt">double</span> <span class="n">maxHealth</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">HealthData</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
        <span class="n">checkArgument</span><span class="p">(</span><span class="n">maxHealth</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="na">health</span> <span class="o">=</span> <span class="n">health</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">maxHealth</span> <span class="o">=</span> <span class="n">maxHealth</span><span class="p">;</span>
        <span class="n">registerGettersAndSetters</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="o">[</span><span class="p">...</span><span class="o">]</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Since we know that both current health and maximum health are bounded values, we need to make sure no values
outside of these bounds can be passed. To achieve this, we use guava’s <code class="docutils literal notranslate"><span class="pre">Preconditions</span></code> of which we import the
required methods statically.</p>
<div class="admonition note">
<p class="first admonition-title">Nota</p>
<p class="last">Never use so-called magic values (arbitrary numbers, booleans etc.) in your code. Instead, locate the
<code class="docutils literal notranslate"><span class="pre">DataConstants</span></code> class and use a fitting constant - or create one, if necessary.</p>
</div>
</div>
<div class="section" id="accessors-defined-by-the-interface">
<h3>Accesorios definidos por la interfaz<a class="headerlink" href="#accessors-defined-by-the-interface" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The interface we implement specifies some methods to access <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/value/mutable/Value.html">Value</a> objects. For <code class="docutils literal notranslate"><span class="pre">HealthData</span></code>, those are
<a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/mutable/entity/HealthData.html#health--">HealthData#health()</a> and <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/mutable/entity/HealthData.html#maxHealth--">HealthData#maxHealth()</a>. Every call to those should yield a new <code class="docutils literal notranslate"><span class="pre">Value</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">MutableBoundedValue</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">health</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">SpongeValueFactory</span><span class="p">.</span><span class="na">boundedBuilder</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">)</span>
        <span class="p">.</span><span class="na">minimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">.</span><span class="na">maximum</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">maxHealth</span><span class="p">)</span>
        <span class="p">.</span><span class="na">defaultValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">maxHealth</span><span class="p">)</span>
        <span class="p">.</span><span class="na">actualValue</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">health</span><span class="p">)</span>
        <span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Ya que “” Doble “” es “” Comparable””, no necesitamos especificar explícitamente un comparador.</p>
</div>
<p>If no current value is specified, calling <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/value/BaseValue.html#get--">BaseValue#get()</a> on the <code class="docutils literal notranslate"><span class="pre">Value</span></code> returns the default value.</p>
</div>
<div class="section" id="copying-and-serialization">
<h3>Copiado y Serializacion<a class="headerlink" href="#copying-and-serialization" title="Enlazar permanentemente con este título">¶</a></h3>
<p>The two methods <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/DataManipulator.html#copy--">DataManipulator#copy()</a> and <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/DataManipulator.html#asImmutable--">DataManipulator#asImmutable()</a> are not much work to
implement. For both you just need to return a mutable or an immutable data manipulator respectively, containing the same
data as the current instance.</p>
<p>The method <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataSerializable.html#toContainer--">DataSerializable#toContainer()</a> is used for serialization purposes. Use
<a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataContainer.html#createNew--">DataContainer#createNew()</a> as the result and apply to it the values stored within this instance.
A <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataContainer.html">DataContainer</a> is basically a map mapping <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataQuery.html">DataQuery</a>s to values. Since a <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/key/Key.html">Key</a> always
contains a corresponding <code class="docutils literal notranslate"><span class="pre">DataQuery</span></code>, just use those by passing the <code class="docutils literal notranslate"><span class="pre">Key</span></code> directly.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">DataContainer</span> <span class="nf">toContainer</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">super</span><span class="p">.</span><span class="na">toContainer</span><span class="p">()</span>
        <span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="na">health</span><span class="p">)</span>
        <span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="na">maxHealth</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="registergettersandsetters">
<h3>registerGettersAndSetters()<a class="headerlink" href="#registergettersandsetters" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un “”DataManipulator”” también proporciona métodos para obtener y establecer datos mediante teclas. La implementación de esto se maneja por “” AbstractData””, pero hay que decirlo que puede acceder a los datos y cómo. Por lo tanto, en el método de “” registerGettersAndSetters()”” tenemos que hacer lo siguiente para cada valor:</p>
<ul class="simple">
<li>register a <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Supplier.html">Supplier</a> to directly get the value</li>
<li>register a <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/function/Consumer.html">Consumer</a> to directly set the value</li>
<li>registra un “” proveedor &lt;Value&gt;”” para obtener el “” valor “” mutable</li>
</ul>
<p>“” Proveedor “” y “” consumidor “” son interfaces funcionales, por lo que puede utilizar Java 8 Lambdas.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="n">SpongeHealthData</span> <span class="nf">setCurrentHealthIfValid</span><span class="p">(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">Float</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">health</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Invalid value for current health&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="n">SpongeHealthData</span> <span class="nf">setMaximumHealthIfValid</span><span class="p">(</span><span class="kt">double</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">Float</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">maxHealth</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;Invalid value for maximum health&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">registerGettersAndSetters</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">registerFieldGetter</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">,</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="p">.</span><span class="na">health</span><span class="p">);</span>
    <span class="n">registerFieldSetter</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">,</span> <span class="k">this</span><span class="p">::</span><span class="n">setCurrentHealthIfValid</span><span class="p">);</span>
    <span class="n">registerKeyValue</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">,</span> <span class="k">this</span><span class="p">::</span><span class="n">health</span><span class="p">);</span>

    <span class="n">registerFieldGetter</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">,</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="k">this</span><span class="p">.</span><span class="na">maxHealth</span><span class="p">);</span>
    <span class="n">registerFieldSetter</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">,</span> <span class="k">this</span><span class="p">::</span><span class="n">setMaximumHealthIfValid</span><span class="p">);</span>
    <span class="n">registerKeyValue</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">,</span> <span class="k">this</span><span class="p">::</span><span class="n">maxHealth</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Consumer</span></code> registered as field setter must perform the adequate checks to make sure the supplied value is valid.
This applies especially for <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataHolder.html">DataHolder</a>s which won’t accept negative values. If a value is invalid, an
<code class="docutils literal notranslate"><span class="pre">IllegalArgumentException</span></code> should be thrown.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">The validity criteria for those setters are the same as for the respective <code class="docutils literal notranslate"><span class="pre">Value</span></code> object, so you might delegate
the validity check to a call of <code class="docutils literal notranslate"><span class="pre">this.health().set()</span></code> and just set <code class="docutils literal notranslate"><span class="pre">this.health</span> <span class="pre">=</span> <span class="pre">value</span></code> if the first
line has not thrown an exception yet.</p>
</div>
<p>Eso es todo. El “” DataManipulator”” debería estar hecho ahora.</p>
</div>
</div>
<div class="section" id="implement-the-immutabledatamanipulator">
<h2>2. implementar la ImmutableDataManipulator<a class="headerlink" href="#implement-the-immutabledatamanipulator" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Implementing the <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/manipulator/ImmutableDataManipulator.html">ImmutableDataManipulator</a> is similar to implementing the mutable one.</p>
<p>Las únicas diferencias son:</p>
<ul class="simple">
<li>El nombre de clase es formado prefijando el nombre mutable de <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code>s con <code class="docutils literal notranslate"><span class="pre">ImmutableSponge</span></code></li>
<li>Heredar de “” ImmutableAbstractData”” en vez de</li>
<li>En lugar de “” registerGettersAndSetters()””, el método se llama “” registerGetters()””</li>
</ul>
<p>When creating <code class="docutils literal notranslate"><span class="pre">ImmutableDataHolder</span></code>s or <code class="docutils literal notranslate"><span class="pre">ImmutableValue</span></code>s, check if it makes sense to use the
<code class="docutils literal notranslate"><span class="pre">ImmutableDataCachingUtil</span></code>. For example, if you have <code class="docutils literal notranslate"><span class="pre">WetData</span></code> which contains nothing more than a boolean, it
is more feasible to retain only two cached instances of <code class="docutils literal notranslate"><span class="pre">ImmutableWetData</span></code> - one for each possible value. For
manipulators and values with many possible values (like <code class="docutils literal notranslate"><span class="pre">SignData</span></code>) however, caching is proven to be too expensive.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Deberías declarar los campos de un <code class="docutils literal notranslate"><span class="pre">ImmutableDataManipulator``como</span> <span class="pre">``final</span></code> en orden de prevenir cambios accidentales.</p>
</div>
</div>
<div class="section" id="register-the-key-in-the-keyregistrymodule">
<h2>3. Register the Key in the KeyRegistryModule<a class="headerlink" href="#register-the-key-in-the-keyregistrymodule" title="Enlazar permanentemente con este título">¶</a></h2>
<p>The next step is to register your <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/key/Key.html">Key</a>s to the <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/key/Keys.html">Keys</a>. To do so, locate the
<code class="docutils literal notranslate"><span class="pre">KeyRegistryModule</span></code> class and find the <code class="docutils literal notranslate"><span class="pre">registerDefaults()</span></code> method.
There add a line to register (and create) your used keys.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import static</span> <span class="nn">org.spongepowered.api.data.DataQuery.of</span><span class="p">;</span>

<span class="k">this</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="s">&quot;health&quot;</span><span class="p">,</span> <span class="n">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
        <span class="p">.</span><span class="na">type</span><span class="p">(</span><span class="n">TypeTokens</span><span class="p">.</span><span class="na">BOUNDED_DOUBLE_VALUE_TOKEN</span><span class="p">)</span>
        <span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;health&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">name</span><span class="p">(</span><span class="s">&quot;Health&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">of</span><span class="p">(</span><span class="s">&quot;Health&quot;</span><span class="p">))</span>
        <span class="p">.</span><span class="na">build</span><span class="p">());</span>
<span class="k">this</span><span class="p">.</span><span class="na">register</span><span class="p">(</span><span class="s">&quot;max_health&quot;</span><span class="p">,</span> <span class="n">Key</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
        <span class="p">.</span><span class="na">type</span><span class="p">(</span><span class="n">TypeTokens</span><span class="p">.</span><span class="na">BOUNDED_DOUBLE_VALUE_TOKEN</span><span class="p">)</span>
        <span class="p">.</span><span class="na">id</span><span class="p">(</span><span class="s">&quot;max_health&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">name</span><span class="p">(</span><span class="s">&quot;Max Health&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">query</span><span class="p">(</span><span class="n">of</span><span class="p">(</span><span class="s">&quot;MaxHealth&quot;</span><span class="p">))</span>
        <span class="p">.</span><span class="na">build</span><span class="p">());</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">register(Key)</span></code> method registers your <code class="docutils literal notranslate"><span class="pre">Key</span></code>s for later use. The string used for the id should be the
corresponding constant name from the <code class="docutils literal notranslate"><span class="pre">Keys</span></code> utility class in lowercase. The <code class="docutils literal notranslate"><span class="pre">Key</span></code> itself is created by using the
<a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/key/Key.Builder.html">Key.Builder</a> provided by the <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/key/Key.html#builder--">Key#builder()</a> method. You have to set a <code class="docutils literal notranslate"><span class="pre">TypeToken</span></code>, an <code class="docutils literal notranslate"><span class="pre">id</span></code>,
human readable <code class="docutils literal notranslate"><span class="pre">name</span></code> and a <code class="docutils literal notranslate"><span class="pre">DataQuery</span></code>.
The <code class="docutils literal notranslate"><span class="pre">DataQuery</span></code> is used for serialization. It is created from the statically imported <code class="docutils literal notranslate"><span class="pre">DataQuery.of()</span></code> method
accepting a string. This string should also be the constant name, stripped of underscores and capitalization changed to
upper camel case.</p>
</div>
<div class="section" id="implement-the-dataprocessors">
<h2>4. Implementar los DataProcessors<a class="headerlink" href="#implement-the-dataprocessors" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Lo siguiente son los <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code>. Un``DataProcessor`` funciona como un fuente entre los objetos de nuestro <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> y los de Minecraft’s. Cuando cualquier dato sea solicitado desde u ofrecido a <code class="docutils literal notranslate"><span class="pre">DataHolders</span></code> que existen en Vanilla Minecraft, estas llamadas podrian terminar siendo delegadas a <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code> o a <code class="docutils literal notranslate"><span class="pre">ValueProcessor</span></code>.</p>
<p>For your name, you should use the name of the <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> interface and append <code class="docutils literal notranslate"><span class="pre">Processor</span></code>. Thus, for
<code class="docutils literal notranslate"><span class="pre">HealthData</span></code> we create a <code class="docutils literal notranslate"><span class="pre">HealthDataProcessor</span></code>.</p>
<p>En orden de reducir el código repetitivo,el <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code> debe heredar de la clase abstracta apropiada en el paquete <code class="docutils literal notranslate"><span class="pre">org.spongepowered.common.data.processor.common</span></code>. Puesto que la salud sólo puede estar presente en determinadas entidades, podemos hacer uso de la <code class="docutils literal notranslate"><span class="pre">AbstractEntityDataProcessor`</span> <span class="pre">que</span> <span class="pre">está</span> <span class="pre">destinada</span> <span class="pre">específicamente</span> <span class="pre">a</span> <span class="pre">``Entities</span></code> basadas en <code class="docutils literal notranslate"><span class="pre">net.minecraft.entity.Entity`.</span> <span class="pre">``AbstractEntitySingleDataProcessor</span></code>” requiere menos trabajo de aplicación, pero no puede ser utilizado ya que <code class="docutils literal notranslate"><span class="pre">HealthData</span></code> contiene más de un valor.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HealthDataProcessor</span>
        <span class="kd">extends</span> <span class="n">AbstractEntityDataProcessor</span><span class="o">&lt;</span><span class="n">EntityLivingBase</span><span class="p">,</span> <span class="n">HealthData</span><span class="p">,</span> <span class="n">ImmutableHealthData</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">HealthDataProcessor</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">EntityLivingBase</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">[</span><span class="p">...</span><span class="o">]</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Dependiendo de que abstracción uses, los métodos que tienes que implementar pueden diferir bastante, dependiendo de cuánto trabajo de implementación ya se haya podido hacer en la clase abstracta. Generalmente, los métodos pueden ser categorizados.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">It is possible to create multiple <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code>s for the same data. If vastly different <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code>s
should be supported (for example both a <code class="docutils literal notranslate"><span class="pre">TileEntity</span></code> and a matching <code class="docutils literal notranslate"><span class="pre">ItemStack</span></code>), it may be beneficial to
create one processor for each type of <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> in order to make full use of the provided abstractions.
Make sure you follow the package structure for items, tileentities and entities.</p>
</div>
<div class="section" id="validation-methods">
<h3>Métodos de Validación<a class="headerlink" href="#validation-methods" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Always return a boolean value. If any of the <code class="docutils literal notranslate"><span class="pre">supports(target)</span></code> methods is called it should perform a general check if
the supplied target generally supports the kind of data handled by our <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code>. Based on your level of
abstraction you might not have to implement it at all, if you have to just implement the most specific one, as the more
generic ones usually delegate to them.</p>
<p>Nuestro``HealthDataProcessor`` <code class="docutils literal notranslate"><span class="pre">supports()</span></code> es implementado por la <code class="docutils literal notranslate"><span class="pre">AbstractEntityDataProcessor</span></code>. Por defecto, devolverá true si el argumento suministrado es una instancia de la clase especificada al llamar al constructor <code class="docutils literal notranslate"><span class="pre">super()</span></code>.</p>
<p>Por el contrario, requerimos a proporcionar un método <code class="docutils literal notranslate"><span class="pre">doesDataExist()</span></code>. Puesto que la abstracción no sabe cómo obtener los datos, deja esta función a implementar. Como el nombre lo indica, el método debe comprobar si el dato ya existe en el destino soportado. Para el <code class="docutils literal notranslate"><span class="pre">HealthDataProcessor</span></code>, esto siempre devuelve true, porque cada entidad viva siempre tiene salud.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">doesDataExist</span><span class="p">(</span><span class="n">EntityLivingBase</span> <span class="n">entity</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="setter-methods">
<h3>Metodos Setter<a class="headerlink" href="#setter-methods" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un método setter recibe un <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> de algún tipo y algunos datos que deberían ser aplicados a el, si es posible.</p>
<p>La interfaz <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code> define un método <code class="docutils literal notranslate"><span class="pre">set()</span></code> aceptando un <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> y un <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> que devuelve un <code class="docutils literal notranslate"><span class="pre">DataTransactionResult</span></code>. Dependiendo de la clase de abstracción utilizada, algunas de las funciones necesarias ya podrían ser implementadas.</p>
<p>En este caso, el <code class="docutils literal notranslate"><span class="pre">AbstractEntityDataProcessor</span></code> se encarga de la mayor parte de eso y sólo requiere de un método para establecer algunos valores para devolver <code class="docutils literal notranslate"><span class="pre">true</span></code> si fue exitoso y <code class="docutils literal notranslate"><span class="pre">false</span></code> si no. Todo comprueba si el <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> soporta la <code class="docutils literal notranslate"><span class="pre">Data</span></code> de la que esta a cargo, la clase abstracta sólo pasará un Mapa revisando cada <code class="docutils literal notranslate"><span class="pre">Key</span></code> desde el <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> hasta su valor y luego construirá un <code class="docutils literal notranslate"><span class="pre">DataTransactionResult</span></code> dependiendo de si la operación fue acertada o no.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">set</span><span class="p">(</span><span class="n">EntityLivingBase</span> <span class="n">entity</span><span class="p">,</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Key</span><span class="o">&lt;?&gt;</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">keyValues</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">entity</span><span class="p">.</span><span class="na">getEntityAttribute</span><span class="p">(</span><span class="n">SharedMonsterAttributes</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">)</span>
            <span class="p">.</span><span class="na">setBaseValue</span><span class="p">(((</span><span class="n">Double</span><span class="p">)</span> <span class="n">keyValues</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">)).</span><span class="na">floatValue</span><span class="p">());</span>
    <span class="kt">float</span> <span class="n">health</span> <span class="o">=</span> <span class="p">((</span><span class="n">Double</span><span class="p">)</span> <span class="n">keyValues</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">)).</span><span class="na">floatValue</span><span class="p">();</span>
    <span class="n">entity</span><span class="p">.</span><span class="na">setHealth</span><span class="p">(</span><span class="n">health</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">To understand <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataTransactionResult.html">DataTransactionResult</a>s, check the <a class="reference internal" href="../../plugin/data/transactions.html"><span class="doc">corresponding docs page</span></a> and refer to the <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataTransactionResult.Builder.html">DataTransactionResult.Builder</a> docs to create one.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">Especially when working with <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/item/inventory/ItemStack.html">ItemStack</a>s it is likely that you will need to deal with
<code class="docutils literal notranslate"><span class="pre">NBTTagCompound</span></code>s directly. Many NBT keys are already defined as constants in the <code class="docutils literal notranslate"><span class="pre">NbtDataUtil</span></code> class.
If your required key is not there, you need to add it in order to avoid “magic values” in the code.</p>
</div>
</div>
<div class="section" id="removal-method">
<h3>Método de Eliminación<a class="headerlink" href="#removal-method" title="Enlazar permanentemente con este título">¶</a></h3>
<p>El método <code class="docutils literal notranslate"><span class="pre">remove()</span></code> intenta remover los datos de <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> y devuelve un <code class="docutils literal notranslate"><span class="pre">DataTransactionResult</span></code>.</p>
<p>Removal is not abstracted in any abstract <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code> as the abstractions have no way of knowing if the data
is always present on a compatible <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> (like <code class="docutils literal notranslate"><span class="pre">WetData</span></code> or <code class="docutils literal notranslate"><span class="pre">HealthData</span></code>) or if it may or may not be present
(like <code class="docutils literal notranslate"><span class="pre">LoreData</span></code>). If the data is always present, <code class="docutils literal notranslate"><span class="pre">remove()</span></code> must always fail. If it may or may not be present,
<code class="docutils literal notranslate"><span class="pre">remove()</span></code> should remove it.</p>
<p>Since a living entity <em>always</em> has health, <code class="docutils literal notranslate"><span class="pre">HealthData</span></code> is always present and removal therefore not supported.
Therefore we just return <a class="reference external" href="https://spongedl.neptunepowered.org/javadocs/7.2.0/org/spongepowered/api/data/DataTransactionResult.html#failNoData--">DataTransactionResult#failNoData()</a>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">DataTransactionResult</span> <span class="nf">remove</span><span class="p">(</span><span class="n">DataHolder</span> <span class="n">dataHolder</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">DataTransactionResult</span><span class="p">.</span><span class="na">failNoData</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="getter-methods">
<h3>Metodos Getter<a class="headerlink" href="#getter-methods" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los métodos getter obtienen los datos de un <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> y devuelven un <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> opcional. La interfaz <code class="docutils literal notranslate"><span class="pre">DataProcessor`</span> <span class="pre">especifica</span> <span class="pre">los</span> <span class="pre">métodos</span> <span class="pre">``from()</span></code> y <code class="docutils literal notranslate"><span class="pre">createFrom()</span></code>, siendo la diferencia que <code class="docutils literal notranslate"><span class="pre">from()</span></code> devolverá <code class="docutils literal notranslate"><span class="pre">Optional.empty()</span></code> si el titular de datos es compatible, pero de hecho no contiene los datos, mientras <code class="docutils literal notranslate"><span class="pre">createFrom()</span></code> proveerá un titular <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> con valores por defecto en ese caso.</p>
<p>De nuevo, <code class="docutils literal notranslate"><span class="pre">AbstractEntityDataProcessor</span></code> proveerá la mayoría de la implementación para este y solo requiere un método para obtener el valor actual presente en el <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code>. Este método solo es llamado por <code class="docutils literal notranslate"><span class="pre">supports()</span></code> y``doesDataExist()`` ambos devolviendo verdadero, lo que significa que es ejecutado asumiendo que los datos están presentes.</p>
<div class="admonition warning">
<p class="first admonition-title">Advertencia</p>
<p class="last">If the data may not always exist on the target <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code>, e.g. if the <code class="docutils literal notranslate"><span class="pre">remove()</span></code> function may be successful
(see above), it is imperative that you implement the <code class="docutils literal notranslate"><span class="pre">doesDataExist()</span></code> method so that it returns <code class="docutils literal notranslate"><span class="pre">true</span></code>
if the data is present and <code class="docutils literal notranslate"><span class="pre">false</span></code> if it is not.</p>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">Key</span><span class="o">&lt;?&gt;</span><span class="p">,</span> <span class="o">?&gt;</span> <span class="n">getValues</span><span class="p">(</span><span class="n">EntityLivingBase</span> <span class="n">entity</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">health</span> <span class="o">=</span> <span class="n">entity</span><span class="p">.</span><span class="na">getHealth</span><span class="p">();</span>
    <span class="kd">final</span> <span class="kt">double</span> <span class="n">maxHealth</span> <span class="o">=</span> <span class="n">entity</span><span class="p">.</span><span class="na">getMaxHealth</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">ImmutableMap</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">,</span> <span class="n">health</span><span class="p">,</span> <span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">,</span> <span class="n">maxHealth</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="filler-methods">
<h3>Métodos Filler<a class="headerlink" href="#filler-methods" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un método filler es diferente de un metodo getter en que este recibe un <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> para llenar con valores. Estos valores o bien vienen de un <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> o tienen que ser des-serializados desde un <code class="docutils literal notranslate"><span class="pre">DataContainer</span></code>. El metodo devuelve <code class="docutils literal notranslate"><span class="pre">Optional.empty()</span></code> si el <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code> es incompatible.</p>
<p><code class="docutils literal notranslate"><span class="pre">AbstractEntityDataProcessor</span></code> already handles filling from <code class="docutils literal notranslate"><span class="pre">DataHolders</span></code> by creating a <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code>
from the holder and then merging it with the supplied manipulator, but the <code class="docutils literal notranslate"><span class="pre">DataContainer</span></code> deserialization it
cannot provide.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">HealthData</span><span class="o">&gt;</span> <span class="nf">fill</span><span class="p">(</span><span class="n">DataContainer</span> <span class="n">container</span><span class="p">,</span> <span class="n">HealthData</span> <span class="n">healthData</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">container</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">.</span><span class="na">getQuery</span><span class="p">())</span> <span class="o">||</span> <span class="o">!</span><span class="n">container</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">.</span><span class="na">getQuery</span><span class="p">()))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">healthData</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">,</span> <span class="n">getData</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">));</span>
    <span class="n">healthData</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">,</span> <span class="n">getData</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">healthData</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fill()</span></code> method is to return an <code class="docutils literal notranslate"><span class="pre">Optional</span></code> of the altered <code class="docutils literal notranslate"><span class="pre">healthData</span></code>, if and only if all required data could
be obtained from the <code class="docutils literal notranslate"><span class="pre">DataContainer</span></code>.</p>
</div>
<div class="section" id="other-methods">
<h3>Otros Metodos<a class="headerlink" href="#other-methods" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Dependiendo de la superclase abstracta utilizada, otros métodos pueden ser requeridos. Por ejemplo, <code class="docutils literal notranslate"><span class="pre">AbstractEntityDataProcessor</span></code> necesita crear instancias <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> en varios puntos. No puede hacer esto ya que no conoce a la implementación de la clase ni el constructor a utilizar. Por lo tanto utiliza una función abstracta que debe ser proporcionada por la aplicación final. No hace nada más que crear un <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> con datos por defecto.</p>
<p>Si implementaste tu <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> como se recomendó, puedes simplemente usar los constructores sin argumentos.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">HealthData</span> <span class="nf">createManipulator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">SpongeHealthData</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="implement-the-valueprocessors">
<h2>5. Implemente los ValueProcessors<a class="headerlink" href="#implement-the-valueprocessors" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Puede ofrecer no sólo un <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> a un <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code>, pero también un <code class="docutils literal notranslate"><span class="pre">Value</span></code> propio. Por lo tanto, debe proporcionar al menos un <code class="docutils literal notranslate"><span class="pre">ValueProcessor</span></code> para cada <code class="docutils literal notranslate"><span class="pre">Key</span></code> en su <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code>. Un <code class="docutils literal notranslate"><span class="pre">ValueProcessor</span></code> es nombrado despues de que el nombre de la constante de su <code class="docutils literal notranslate"><span class="pre">Key</span></code> en la clase <code class="docutils literal notranslate"><span class="pre">Keys</span></code> esté en una manera similar a su <code class="docutils literal notranslate"><span class="pre">DataQuery</span></code>. El nombre de la constante es despojado de subrayados “” ValueProcessor””. El nombre de constante es despojado de subrayados, utilizado en mayuscula y luego se le añade el sufijo <code class="docutils literal notranslate"><span class="pre">ValueProcessor</span></code>.</p>
<p>Un <code class="docutils literal notranslate"><span class="pre">ValueProcessor</span></code> siempre debe heredar de <code class="docutils literal notranslate"><span class="pre">AbstractSpongeValueProcessor</span></code>, que ya maneja una porción de los controles <code class="docutils literal notranslate"><span class="pre">supports()</span></code> en función del tipo del <code class="docutils literal notranslate"><span class="pre">DataHolder</span></code>. Para <code class="docutils literal notranslate"><span class="pre">Keys.HEALTH</span></code>, crearemos y construiremos un <code class="docutils literal notranslate"><span class="pre">HealthValueProcessor</span></code> como sigue.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HealthValueProcessor</span>
        <span class="kd">extends</span> <span class="n">AbstractSpongeValueProcessor</span><span class="o">&lt;</span><span class="n">EntityLivingBase</span><span class="p">,</span> <span class="n">Double</span><span class="p">,</span> <span class="n">MutableBoundedValue</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;&gt;</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="nf">HealthValueProcessor</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">EntityLivingBase</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">[</span><span class="p">...</span><span class="o">]</span>

<span class="p">}</span>
</pre></div>
</div>
<p>Ahora los <code class="docutils literal notranslate"><span class="pre">AbstractSpongeValueProcessor</span></code> nos liberaran de la necesidad de comprobar si el valor es soportado. Se asume que es soportado si el objetivo <code class="docutils literal notranslate"><span class="pre">ValueContainer</span></code> es del tipo <code class="docutils literal notranslate"><span class="pre">EntityLivingBase</span></code>.</p>
<div class="admonition tip">
<p class="first admonition-title">Truco</p>
<p class="last">Para un mayor control sobre que objetos <code class="docutils literal notranslate"><span class="pre">EntityLivingBase</span></code> son soportados, el método <code class="docutils literal notranslate"><span class="pre">supports(EntityLivingBase)</span></code> puede ser sobrescrito.</p>
</div>
<p>De nuevo, la mayoría del trabajo es hecho por la clase abstracción. Solo necesitamos implementar dos métodos de ayuda para crear un <code class="docutils literal notranslate"><span class="pre">Value</span></code> y sus contrapartes inmutables y tres métodos para obtener, configura y establece los datos.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">MutableBoundedValue</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">constructValue</span><span class="p">(</span><span class="n">Double</span> <span class="n">health</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">SpongeValueFactory</span><span class="p">.</span><span class="na">boundedBuilder</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">)</span>
        <span class="p">.</span><span class="na">minimum</span><span class="p">(</span><span class="mf">0D</span><span class="p">)</span>
        <span class="p">.</span><span class="na">maximum</span><span class="p">(((</span><span class="n">Float</span><span class="p">)</span> <span class="n">Float</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">).</span><span class="na">doubleValue</span><span class="p">())</span>
        <span class="p">.</span><span class="na">defaultValue</span><span class="p">(</span><span class="mi">20</span><span class="n">D</span><span class="p">)</span>
        <span class="p">.</span><span class="na">actualValue</span><span class="p">(</span><span class="n">health</span><span class="p">)</span>
        <span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">ImmutableBoundedValue</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">constructImmutableValue</span><span class="p">(</span><span class="n">Double</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">constructValue</span><span class="p">(</span><span class="n">value</span><span class="p">).</span><span class="na">asImmutable</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Double</span><span class="o">&gt;</span> <span class="nf">getVal</span><span class="p">(</span><span class="n">EntityLivingBase</span> <span class="n">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span> <span class="n">container</span><span class="p">.</span><span class="na">getHealth</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ya que es imposible para un <code class="docutils literal notranslate"><span class="pre">EntityLivingBase`</span> <span class="pre">no</span> <span class="pre">tener</span> <span class="pre">salud,</span> <span class="pre">este</span> <span class="pre">método</span> <span class="pre">nunca</span> <span class="pre">devolverá</span> <span class="pre">``Optional.empty()</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">boolean</span> <span class="nf">set</span><span class="p">(</span><span class="n">EntityLivingBase</span> <span class="n">container</span><span class="p">,</span> <span class="n">Double</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">Float</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">container</span><span class="p">.</span><span class="na">setHealth</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="na">floatValue</span><span class="p">());</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El método <code class="docutils literal notranslate"><span class="pre">set()</span></code> devolverá un valor booleano indicando si el valor podría ser establecido exitosamente. Esta implementación rechazará los valores por fuera de los limites usados en nuestros métodos de construcción de valor anteriormente.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">DataTransactionResult</span> <span class="nf">removeFrom</span><span class="p">(</span><span class="n">ValueContainer</span><span class="o">&lt;?&gt;</span> <span class="n">container</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">DataTransactionResult</span><span class="p">.</span><span class="na">failNoData</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ya que es garantizado que los datos estarán siempre presentes, cualquier intento de removerlos fallará.</p>
</div>
<div class="section" id="register-processors">
<h2>6. Procesadores de Registro<a class="headerlink" href="#register-processors" title="Enlazar permanentemente con este título">¶</a></h2>
<p>In order for Sponge to be able to use our manipulators and processors, we need to register them. This is done in the
<code class="docutils literal notranslate"><span class="pre">DataRegistrar</span></code> class. In the <code class="docutils literal notranslate"><span class="pre">setupSerialization()</span></code> method there are two large blocks of registrations to which we
add our processors.</p>
<div class="section" id="dataprocessors">
<h3>ProcesadoresDeDatos<a class="headerlink" href="#dataprocessors" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Un <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code> es registrado junto con la interfaz y las clases de implementación del <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code> que maneja. Para cada par de <code class="docutils literal notranslate"><span class="pre">DataManipulator</span></code>s mutable / inmutable al menos un <code class="docutils literal notranslate"><span class="pre">DataProcessor</span></code> debe ser registrado.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DataUtil</span><span class="p">.</span><span class="na">registerDataProcessorAndImpl</span><span class="p">(</span><span class="n">HealthData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">SpongeHealthData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
        <span class="n">ImmutableHealthData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">ImmutableSpongeHealthData</span><span class="p">.</span><span class="na">class</span><span class="p">,</span>
        <span class="k">new</span> <span class="n">HealthDataProcessor</span><span class="p">());</span>
</pre></div>
</div>
</div>
<div class="section" id="valueprocessors">
<h3>ProcesadoresDeValor<a class="headerlink" href="#valueprocessors" title="Enlazar permanentemente con este título">¶</a></h3>
<p>Los procesadores de valor son registrados al fondo de la propia función, Para cada <code class="docutils literal notranslate"><span class="pre">Key</span></code> pueden ser registrados múltiples procesadores por llamadas subsecuentes del método <code class="docutils literal notranslate"><span class="pre">registerValueProcessor()</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">DataUtil</span><span class="p">.</span><span class="na">registerValueProcessor</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">HEALTH</span><span class="p">,</span> <span class="k">new</span> <span class="n">HealthValueProcessor</span><span class="p">());</span>
<span class="n">DataUtil</span><span class="p">.</span><span class="na">registerValueProcessor</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">MAX_HEALTH</span><span class="p">,</span> <span class="k">new</span> <span class="n">MaxHealthValueProcessor</span><span class="p">());</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-block-data">
<h2>Implementando Datos de Bloques<a class="headerlink" href="#implementing-block-data" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Los datos de bloques son un poco diferentes de otros tipos de datos que son implementados mezclándose en los bloques como tal. Hay varios métodos en <code class="docutils literal notranslate"><span class="pre">org.spongepowered.mixin.core.block.MixinBlock</span></code> que deben ser sobrescritos para implementar los datos para los bloques.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Mixin</span><span class="p">(</span><span class="n">BlockHorizontal</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">MixinBlockHorizontal</span> <span class="kd">extends</span> <span class="n">MixinBlock</span> <span class="p">{</span>

    <span class="o">[</span><span class="p">...</span><span class="o">]</span>

<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">supports()</span></code> debería devolver <code class="docutils literal notranslate"><span class="pre">true</span></code> si bien la interfaz <code class="docutils literal notranslate"><span class="pre">ImmutableDataManipulator</span></code> es asignable desde la <code class="docutils literal notranslate"><span class="pre">Class</span></code> pasada como argumento, o si la superclase la soporta.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supports</span><span class="p">(</span><span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">ImmutableDataManipulator</span><span class="o">&lt;?</span><span class="p">,</span> <span class="o">?&gt;&gt;</span> <span class="n">immutable</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">super</span><span class="p">.</span><span class="na">supports</span><span class="p">(</span><span class="n">immutable</span><span class="p">)</span> <span class="o">||</span> <span class="n">ImmutableDirectionalData</span><span class="p">.</span><span class="na">class</span><span class="p">.</span><span class="na">isAssignableFrom</span><span class="p">(</span><span class="n">immutable</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">getStateWithData()</span></code> deberia devolver un nuevo <code class="docutils literal notranslate"><span class="pre">BlockState</span></code> con los datos del <a href="#id1"><span class="problematic" id="id2">``</span></a>ImmutableDataManipulator` aplicados a él. Si el manipulador no es soportado directamente, el método debería delegar a la superclase.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">BlockState</span><span class="o">&gt;</span> <span class="nf">getStateWithData</span><span class="p">(</span><span class="n">IBlockState</span> <span class="n">blockState</span><span class="p">,</span> <span class="n">ImmutableDataManipulator</span><span class="o">&lt;?</span><span class="p">,</span> <span class="o">?&gt;</span> <span class="n">manipulator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">manipulator</span> <span class="k">instanceof</span> <span class="n">ImmutableDirectionalData</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">Direction</span> <span class="n">direction</span> <span class="o">=</span> <span class="p">((</span><span class="n">ImmutableDirectionalData</span><span class="p">)</span> <span class="n">manipulator</span><span class="p">).</span><span class="na">direction</span><span class="p">().</span><span class="na">get</span><span class="p">();</span>
        <span class="kd">final</span> <span class="n">EnumFacing</span> <span class="n">facing</span> <span class="o">=</span> <span class="n">DirectionResolver</span><span class="p">.</span><span class="na">getFor</span><span class="p">(</span><span class="n">direction</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">((</span><span class="n">BlockState</span><span class="p">)</span> <span class="n">blockState</span><span class="p">.</span><span class="na">withProperty</span><span class="p">(</span><span class="n">BlockHorizontal</span><span class="p">.</span><span class="na">FACING</span><span class="p">,</span> <span class="n">facing</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kd">super</span><span class="p">.</span><span class="na">getStateWithData</span><span class="p">(</span><span class="n">blockState</span><span class="p">,</span> <span class="n">manipulator</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">getStateWithValue()</span></code> es el equivalente de``getStateWithData()``, pero funciona con <code class="docutils literal notranslate"><span class="pre">Key</span></code>s individuales.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">BlockState</span><span class="o">&gt;</span> <span class="nf">getStateWithValue</span><span class="p">(</span><span class="n">IBlockState</span> <span class="n">blockState</span><span class="p">,</span> <span class="n">Key</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">BaseValue</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;&gt;</span> <span class="n">key</span><span class="p">,</span> <span class="n">E</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="na">DIRECTION</span><span class="p">))</span> <span class="p">{</span>
        <span class="kd">final</span> <span class="n">Direction</span> <span class="n">direction</span> <span class="o">=</span> <span class="p">(</span><span class="n">Direction</span><span class="p">)</span> <span class="n">value</span><span class="p">;</span>
        <span class="kd">final</span> <span class="n">EnumFacing</span> <span class="n">facing</span> <span class="o">=</span> <span class="n">DirectionResolver</span><span class="p">.</span><span class="na">getFor</span><span class="p">(</span><span class="n">direction</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">((</span><span class="n">BlockState</span><span class="p">)</span> <span class="n">blockState</span><span class="p">.</span><span class="na">withProperty</span><span class="p">(</span><span class="n">BlockHorizontal</span><span class="p">.</span><span class="na">FACING</span><span class="p">,</span> <span class="n">facing</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kd">super</span><span class="p">.</span><span class="na">getStateWithValue</span><span class="p">(</span><span class="n">blockState</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Por último, <code class="docutils literal notranslate"><span class="pre">getManipulators()</span></code> deberia devolver una lista de los “” ImmutableDataManipulator”” s soporta el bloque, junto con los valores actuales para el “” IBlockState”” siempre. Debe incluir todos “” ImmutableDataManipulator”” s de la superclase.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">ImmutableDataManipulator</span><span class="o">&lt;?</span><span class="p">,</span> <span class="o">?&gt;&gt;</span> <span class="n">getManipulators</span><span class="p">(</span><span class="n">IBlockState</span> <span class="n">blockState</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">ImmutableList</span><span class="p">.</span><span class="o">&lt;</span><span class="n">ImmutableDataManipulator</span><span class="o">&lt;?</span><span class="p">,</span> <span class="o">?&gt;&gt;</span><span class="n">builder</span><span class="p">()</span>
            <span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="kd">super</span><span class="p">.</span><span class="na">getManipulators</span><span class="p">(</span><span class="n">blockState</span><span class="p">))</span>
            <span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">ImmutableSpongeDirectionalData</span><span class="p">(</span><span class="n">DirectionResolver</span><span class="p">.</span><span class="na">getFor</span><span class="p">(</span><span class="n">blockState</span><span class="p">.</span><span class="na">getValue</span><span class="p">(</span><span class="n">BlockHorizontal</span><span class="p">.</span><span class="na">FACING</span><span class="p">))))</span>
            <span class="p">.</span><span class="na">build</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="further-information">
<h2>Mas Información<a class="headerlink" href="#further-information" title="Enlazar permanentemente con este título">¶</a></h2>
<p>Con <code class="docutils literal notranslate"><span class="pre">Data</span></code> siendo un concepto algo abstracto en la esponja, es difícil dar instrucciones generales sobre cómo adquirir los datos necesarios de las clases de Minecraft sí mismo. Puede ser útil echar un vistazo a procesadores ya puesto en ejecución similares a la que está trabajando para obtener una mejor comprensión de cómo debería funcionar.</p>
<p>If you are stuck or are unsure about certain aspects, go visit the <code class="docutils literal notranslate"><span class="pre">#spongedev</span></code> IRC channel,
the <code class="docutils literal notranslate"><span class="pre">#dev</span></code> channel on Discord, the forums, or open up an Issue on GitHub.
Be sure to check the <a class="reference external" href="https://github.com/SpongePowered/SpongeCommon/issues/8">Data Processor Implementation Checklist</a>
for general contribution requirements.</p>
</div>
</div>

           </div>
          </div>
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../spongedocs.html" class="btn btn-neutral float-right" title="Escritura de los Spongedocs" accesskey="n" rel="next">Siguiente <span class="fa fa-angle-right"></span></a>
        <a href="mixins.html" class="btn btn-neutral" title="Mixins" accesskey="p" rel="prev"><span class="fa fa-angle-left"></span> Previo</a>
    </div>

    <hr/>

    <section id="license-footer">
        <p>Except where otherwise noted,
            <a xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" property="dct:title" rel="cc:attributionURL" href="https://github.com/SpongePowered/SpongeDocs">SpongeDocs</a>
            is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        </p>
        <a id="license-icons" rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" title="CC-BY-SA" aria-hidden="true">cba</a>
    </section>
</footer>        </div>
      </div>

    </section>

  </div>


<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <i class="fa fa-book"> <span>SpongeDocs</span></i>
        v: 7.2.0
    <img src="../../_static/flags/es_ES.svg"
         alt="es" title="Español">
        <span class="fa fa-caret-down"></span>
    </span>
    <div id="versions" class="rst-other-versions">




    </div>
</div>

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'7.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>      <script type="text/javascript" src="../../_static/jquery.js"></script>      <script type="text/javascript" src="../../_static/underscore.js"></script>      <script type="text/javascript" src="../../_static/doctools.js"></script>      <script type="text/javascript" src="../../_static/language_data.js"></script>      <script type="text/javascript" src="../../_static/translations.js"></script>      <script type="text/javascript" src="../../_static/spongedocs.js"></script>

    <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
 
</body>
</html>